/* //CORRIGIR 
OPERAÇÕES PARA RODAR DIRETO AQUI(enquanto arrumo a parte das listas, depois desfazer os passos):
  Em "page.html":   
        -já removi: Adicionei: ' || "padrao"'
        já deixei o HTML rodável no GAS ou externo: - Troquei "enviarArray"  por  "google.script.run.withSuccessHandler"
        - Atualizar o :"https://script.google.com/macros/s/AKfycbwXoNqeebjQiEdjBjVKjfd9qd2_5OkXy3SgUXZ0EfngU-tP54Y_VItDtlrGzYJMqqUe/exec"

  No GAS:           
        já troquei a planilha oficial para esta: - Alterei a id da planilha
        já  excluí:         - Adicionei em dadosIniciais(): mailCapturado =  "ezequiel.melo@ifsc.edu.br"; 
        já desfeito:        - Em: E_MAIL_DETECTADO   -> eu coloquei:  "ezequiel.melo@ifsc.edu.br"
*/ 



























 ////////////////////////////////////////////////DADOS GLOBAIS//////////////////////////////////////////////

const PLANILHA = SpreadsheetApp.openById("1SCEk6co1cdFQLgYLfIqmiy5XKj0nH5nfcekSDWJ8CF0"),//const ID = ; //ID DA PLANILHA
      PAGINA = "Avaliações", // NOME DA ABA/PÁGINA das notas
      MEU_CLIENT_ID = '90142364675-oeo4houafkfl9sj6fcbqt71injv8v3jj.apps.googleusercontent.com',// Client ID OAuth 2.0 do site
      CHAVE_CRIPTOGAFIA = "Aqui_vai_uma-chav3*bem,comprida-E-difícil!de¨advinhar",
		  DIAS_DURACAO_LOGADO = 7,
      TEXTO_EXIGIDO_NO_EMAIL = "ifsc.edu.br", //Exige esse final de e-mail(no final pois o invasor criaria e-mail com isso)
      EMAILCHEFE = ["ezequiel.melo@ifsc.edu.br", "ezequinewton@gmail.com", "admin@email.com"],
      EMAILOLHADOR =  ["cae@ifsc.edu.br", "ezequiel.melover@ifsc.edu.br", "monitoresDeFisica@email.com"],
      SALVAR_REGISTROS_EM_PLANILHA = 1,
      UTILIZAR_DO_GET = "false",
CHAVE_MESTRA_SECRETA = "chave fácil", //Obsoleto
SESSAO_VALIDADE_DIAS = 7; //Obsoleto;
let   E_MAIL_DETECTADO = Session.getActiveUser().getEmail() || ''; /* "ezequiel.melo@ifsc.edu.br";*/
      //EXIGIR_LOGIN = true, //Exige que o site que envie o formulário tenha autenticação do GoogLe?
 ////////////////////////////////////////////////DADOS GLOBAIS//////////////////////////////////////////////
consolePlanilha(E_MAIL_DETECTADO)




/** ///////////////////////////////////////////////////////INSTRUÇÕES////////////////////////////////////////////////////////
- Se não tiver "id_token" do Google e o site for "https://www.......?padrao" envia o texto: "padrao" e abre o login da Nicoly.
- Implantar o GAS: Executar como "Eu" e "Qualquer pessoa"





/////////////////////////////////////////////////////////INSTRUÇÕES///////////////////////////////////////////////////////*/








  


/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>  FUNÇÃO DE RELAÇÃO ENTRE FRONT E BACK-END  <<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/
 


function doPost(e) {try{ 

  let dadosProcessados, respostaStatus = "success", mensagemResposta = "", textoRecebidoOriginal = "",varJson = "",mail;

  try {    // 1. Verificar se o payloadJson foi enviado
    if (!e || !e.parameter || !e.parameter.payloadJson) {  throw new Error("Nenhum dado (payloadJson) recebido.");   }
    textoRecebidoOriginal = e.parameter.payloadJson;

    // 2. Converter o payloadJson (string) de volta para um objeto JSON
    varJson = JSON.parse(textoRecebidoOriginal);

    //Se não exigir login então permite executar próximos passos, se exigir, chamar função de verificar autenticidade
   //if(!EXIGIR_LOGIN){mail = Session.getActiveUser().getEmail();consolePlanilha("Executar próximos passos sem login.")}else{
      //consolePlanilha("Exige login.")
/**       mail = verificarAutenticidadeSite(varJson.id);consolePlanilha("mail: "+mail);
      if(mail){        consolePlanilha("E-mail recebido.");
        E_MAIL_DETECTADO = mail;
        if(mail.endsWith(TEXTO_EXIGIDO_NO_EMAIL)||EMAILCHEFE.includes(mail)||EMAILOLHADOR.includes(mail)){
          consolePlanilha("Executar próximos passos pós login.")}
        else{
          var response = {  status: "error",    message: "O e-mail: "+mail+" não está cadastrado.",    };
          return ContentService.createTextOutput(JSON.stringify(response)).setMimeType(ContentService.MimeType.JSON);
        }
      }else{    consolePlanilha("\n\n\nsem login detectado");
      ///////Código abaixo não está sendo acessado pois "verificarAutenticidadeSite" com token inválido bloqueia.
        var response = {  status: "error",    message: "LOGIN EXIGIDO",    };
        return ContentService.createTextOutput(JSON.stringify(response)).setMimeType(ContentService.MimeType.JSON);
      } */
    // }


    ////////////////////////////////////////// Transforma texto em função//////////////////////////////////////////
    if (/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(varJson.tipo)) {
      let funcaoChamada = varJson.tipo + "("+ JSON.stringify(varJson.dados).replace(/^\[|\]$/g, '')+ ");";
      consolePlanilha("funcaoChamada: "+funcaoChamada);
      dadosProcessados = eval(funcaoChamada); 
    }                    


    mensagemResposta = JSON.stringify(dadosProcessados);
    consolePlanilha("dadosProcessados: "+dadosProcessados)
    consolePlanilha("mensagemResposta: "+mensagemResposta)

  } catch (error) {
    consolePlanilha(`Erro no doPost: ${error.toString()}\nStack: ${error.stack}\nPayload Recebido: ${textoRecebidoOriginal}\nObjeto 'e': ${JSON.stringify(e)}`);
    respostaStatus = "error";
    mensagemResposta = `Ocorreu um erro ao processar sua solicitação: ${error.message}\n
    Erro no doPost: ${error.toString()}\n
    Stack: ${error.stack}\n
    Payload Recebido: ${textoRecebidoOriginal}\n
    Objeto 'e': ${JSON.stringify(e)}`;
  }

  // 4. Montar e retornar a resposta
  var response = {
    status: respostaStatus,
    tipo: varJson.tipo,
    email: mail, 
    message: mensagemResposta, // Esta será a string exibida no HTML
    dadosEnviados: `Payload Recebido: ${textoRecebidoOriginal}\n<br>   Objeto 'e': ${JSON.stringify(e)}`,
    // linhaAdicionada: linhaAdicionada, // Descomente se estiver usando
    // textoSalvo: textoRecebidoOriginal // Para depuração, se necessário
  };

  return ContentService.createTextOutput(JSON.stringify(response)).setMimeType(ContentService.MimeType.JSON);

}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}













   function aaa (){console.log(autenticacaoInicial("GlMbADwZDRBxES0AQRYGDlhaTBEGQ0kHGkMSAEtIQ34wQ0QoE6SNUVlME1RQ8ohQV0xdW1JSSmE2OD1yRlJZb1VFKUIRq8AEWkVCNQxIEazOH1INAUFvN0wXqsuvxAJATnw=", "j"))}
  function bbb (){console.log(criptografar(["nicoly.d@aluno.ifsc.edu.br","Sun Aug 20 2050 13:45:38 GMT-0300 (Horário Padrão de Brasília)"]))} 


function autenticacaoInicial(autenticador,token){try{consolePlanilha(0)
  let validadeLogin = new Date(new Date().getTime() + DIAS_DURACAO_LOGADO * 24 * 60 * 60 * 1000),mail;
  //autenticador = autenticador || criptografar([mail ||,    validadeLogin      ]) || false;

consolePlanilha(E_MAIL_DETECTADO)
  if(E_MAIL_DETECTADO && E_MAIL_DETECTADO.endsWith(TEXTO_EXIGIDO_NO_EMAIL)) {consolePlanilha(1)  //Vê primeiro se o GAS consegue capturar o e-mail
    return [...dadosIniciais(), false];  
  }
  else if(autenticador){consolePlanilha(2) //Se o GAS não conseguir capturar o e-mail ele testa o autenticador próprio
      let mailData = descriptografar(autenticador); //consolePlanilha( new Date(mailData[1]) + " : " + mailData[0]  + " : " + mailData)
      if( mailData && (new Date(mailData[1]) > new Date())  && mailData[0].endsWith(TEXTO_EXIGIDO_NO_EMAIL)){  consolePlanilha(3)//Se tiver autenticador válido
          E_MAIL_DETECTADO = mailData[0];  
          return [...dadosIniciais(), false]; 
      }
  } else if(token){ consolePlanilha(4)//Se o GAS não conseguir capturar, ou o autenticador não existir ou estiver vencido o e-mail ele testa se tem token do google
          mail = verificarAutenticidadeSite(token);consolePlanilha("mail: "+mail)
          if(mail && mail.endsWith(TEXTO_EXIGIDO_NO_EMAIL)){  consolePlanilha(5) 
              autenticador = criptografar([mail,     validadeLogin     ]);
              E_MAIL_DETECTADO = mail;  
              return [...dadosIniciais(), autenticador];  
          }
  } 
  consolePlanilha(6); 
  return false;  //Se o token do google não for válido chamará o login no front-end
      // } 
      // else{consolePlanilha(7); return false }     //Se não der para capturar e-mail de forma alguma chamará o login no front-end
  // }
}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}




function criptografar(textos) {
      if (!Array.isArray(textos) || textos.length === 0 || !CHAVE_CRIPTOGAFIA) return '';
      var textoUnido = JSON.stringify(textos);
      var bytes = Utilities.newBlob(textoUnido).getBytes();
      var key = Utilities.newBlob(CHAVE_CRIPTOGAFIA).getBytes();
      var out = [];
      for (var i = 0; i < bytes.length; i++) out.push(bytes[i] ^ key[i % key.length]);
      return Utilities.base64Encode(out);
    }

    function descriptografar(hash) {
      if (!hash || !CHAVE_CRIPTOGAFIA) return null;
      try {
        var enc = Utilities.base64Decode(hash);
        var key = Utilities.newBlob(CHAVE_CRIPTOGAFIA).getBytes();
        var out = [];
        for (var i = 0; i < enc.length; i++) out.push(enc[i] ^ key[i % key.length]);
        var s = Utilities.newBlob(out).getDataAsString();
        // consolePlanilha(s);
        return JSON.parse(s);
      } catch (e) {
        Logger.log("Erro ao descriptografar: " + e.toString());
        return null;
      }
    }

        // const meusTextos = ["usuario@exemplo.com", "token_secreto_98765"], minhaChave = "Ch4v3S3cr3t4!";
        // console.log("Textos Originais: " + JSON.stringify(meusTextos) + "\nChave: " + minhaChave);
        //   const hashSeguro = criptografar(meusTextos, minhaChave);
        // console.log("Hash Criptografado: " + hashSeguro);  // Criptografar
        // console.log("Textos Descriptografados: " + JSON.stringify(descriptografar(hashSeguro, minhaChave)));  // Descriptografar

           







function verificarAutenticidadeSite(token){try{ //consolePlanilha("id: "+token);
  if (!token || !MEU_CLIENT_ID) { consolePlanilha('Token não fornecido ou não há id de login Google declarado.');  
  return false;   }
  if (token == "padrao") {    return "nicoly.d@aluno.ifsc.edu.br";    }
      
  // 1. Chamar o endpoint de validação do Google
  const response = UrlFetchApp.fetch(`https://oauth2.googleapis.com/tokeninfo?id_token=${token}`); //Esse fetch truca a execução se der algum erro.
  const tokenInfo = JSON.parse(response.getContentText());

  // 2. Verificar o Token de login google é válido: 'audience' (aud) - ESTA É A VERIFICAÇÃO CRUCIAL
  if (tokenInfo.aud !== MEU_CLIENT_ID) {   consolePlanilha('Token inválido: Audience não corresponde.');   }
  else{        
          
  // 3. Verificar se o criador do token é o Google
     if (tokenInfo.iss !== 'https://accounts.google.com' && tokenInfo.iss !== 'accounts.google.com') {
           consolePlanilha('Token inválido: Emissor incorreto.');
        }else{//consolePlanilha("ID único usuário: "+tokenInfo.sub+"\ne-mail: "+tokenInfo.email+" e\n "+tokenInfo.iss+"\nMEU_CLIENT_ID: "+tokenInfo.aud)
          return tokenInfo.email;            
         }
      }
      return false;      
}catch(e){consolePlanilha(`ERRO: ${e.stack}`);return false}}








/**
function doPost(e) {
  try {
    if (!e || !e.parameter || !e.parameter.payloadJson) {
      throw new Error("Nenhum dado (payloadJson) recebido.");
    }

    const textoRecebidoOriginal = e.parameter.payloadJson;
    const varJson = JSON.parse(textoRecebidoOriginal); consolePlanilha("varJson.tipo: "+varJson.tipo)
    let mail;
    let dadosProcessados;

    // --- LÓGICA DE AUTENTICAÇÃO STATELESS ---
    if (varJson.tipo === 'criarSessao') {
      dadosProcessados = criarSessao(varJson.id); // varJson.id aqui é o token do Google
      mail = dadosProcessados ? dadosProcessados.email : null;
    } else if (varJson.tipo === 'encerrarSessao') {
      dadosProcessados = { message: "Logout realizado com sucesso." };
      mail = null;
    } else {
      mail = validarSessao(varJson.id); // varJson.id aqui é o nosso token de sessão
      if (mail) {
        E_MAIL_DETECTADO = mail;
        if (/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(varJson.tipo)) {
          const funcaoChamada = `${varJson.tipo}(${JSON.stringify(varJson.dados).replace(/^\[|\]$/g, '')})`;
          dadosProcessados = eval(funcaoChamada);
        }
      } else {
        const respostaErro = { status: "error", message: "AUTH_FAILED" };
        return ContentService.createTextOutput(JSON.stringify(respostaErro)).setMimeType(ContentService.MimeType.JSON);
      }
    }

    const mensagemResposta = JSON.stringify(dadosProcessados);
    const response = {
      status: "success",
      tipo: varJson.tipo,
      email: mail,
      message: mensagemResposta,
    };
    return ContentService.createTextOutput(JSON.stringify(response)).setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    consolePlanilha(`Erro no doPost: ${error.toString()}\nStack: ${error.stack}`);
    const response = { status: "error", message: `Erro no servidor: ${error.message}` };
    return ContentService.createTextOutput(JSON.stringify(response)).setMimeType(ContentService.MimeType.JSON);
  }
}


// ================== FUNÇÕES DE GERENCIAMENTO DE SESSÃO (STATELESS) ==================

//Cria um token de sessão assinado (stateless).
 
function criarSessao(googleToken) {
  const email = verificarAutenticidadeSite(googleToken);
  if (!email) return null;

  const dataExpiracao = new Date();
  dataExpiracao.setDate(dataExpiracao.getDate() + SESSAO_VALIDADE_DIAS);
  const expTimestamp = dataExpiracao.getTime();

  const payload = `${email}|${expTimestamp}`;
  const signature = Utilities.computeHmacSha256Signature(payload, CHAVE_MESTRA_SECRETA);
  const base64Signature = Utilities.base64Encode(signature);

  const sessionToken = `${Utilities.base64Encode(payload)}.${base64Signature}`;
consolePlanilha(sessionToken)
  return { sessionToken: sessionToken, email: email };
}

//Valida um token de sessão stateless.

function validarSessao(tokenSessao) {
  try {
    if (!tokenSessao || !tokenSessao.includes('.')) return false;

    const parts = tokenSessao.split('.');
    const base64Payload = parts[0];
    const base64Signature = parts[1];

    // Verifica a assinatura
    const expectedSignature = Utilities.computeHmacSha256Signature(base64Payload, CHAVE_MESTRA_SECRETA);
    const expectedBase64Signature = Utilities.base64Encode(expectedSignature);

    if (base64Signature !== expectedBase64Signature) {
      return false; // Assinatura inválida, token foi adulterado
    }

    // Decodifica o payload e verifica a validade
    const payload = Utilities.newBlob(Utilities.base64Decode(base64Payload)).getDataAsString();
    const payloadParts = payload.split('|');
    const email = payloadParts[0];
    const expTimestamp = Number(payloadParts[1]);

    if (new Date().getTime() > expTimestamp) {
      return false; // Token expirado
    }

    return email; // Token válido
  } catch (e) {
    return false; // Erro na validação
  }
}

// Função mantida para compatibilidade com o frontend.
 // No modo stateless, não há nada a fazer no servidor ao encerrar a sessão.
 
function encerrarSessao(tokenSessao) {
  // A remoção do token é feita apenas no localStorage do cliente.
  return { message: "Logout realizado com sucesso." };
}


// ================== FUNÇÃO DE VERIFICAÇÃO DO GOOGLE ==================

function verificarAutenticidadeSite(token) { return "nicoly.d@aluno.ifsc.edu.br"
  try {
    if (!token || !MEU_CLIENT_ID) {
      consolePlanilha('Token não fornecido ou não há id de login Google declarado.');
      return false;
    }
    if (token === "padrao") {
      return "nicoly.d@aluno.ifsc.edu.br";
    }

    const response = UrlFetchApp.fetch(`https://oauth2.googleapis.com/tokeninfo?id_token=${token}`, {
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() !== 200) {
      consolePlanilha(`Token do Google inválido ou expirado. Resposta: ${response.getContentText()}`);
      return false;
    }

    const tokenInfo = JSON.parse(response.getContentText());

    if (tokenInfo.aud !== MEU_CLIENT_ID) {
      consolePlanilha('Token inválido: Audience não corresponde.');
      return false;
    }
    if (tokenInfo.iss !== 'https://accounts.google.com' && tokenInfo.iss !== 'accounts.google.com') {
      consolePlanilha('Token inválido: Emissor incorreto.');
      return false;
    }
    if (!tokenInfo.email.endsWith(TEXTO_EXIGIDO_NO_EMAIL) && !EMAILCHEFE.includes(tokenInfo.email) && !EMAILOLHADOR.includes(tokenInfo.email)) {
      consolePlanilha(`E-mail não permitido: ${tokenInfo.email}`);
      return false;
    }

    return tokenInfo.email;

  } catch (e) {
    consolePlanilha(`Exceção em verificarAutenticidadeSite: ${e.toString()}`);
    return false;
  }
}
*/





//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
// Função substituta ao login por API do Google:  - Troca "enviarArray"  por  "google.script.run.withSuccessHandler"
//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//


function doGet() {
 //  var email = /*RECEBER E-MAIL AQUI */"ezequiel.melo@ifsc.edu.br"; //Session.getActiveUser().getEmail() || '', template;

 if (E_MAIL_DETECTADO && E_MAIL_DETECTADO.includes(TEXTO_EXIGIDO_NO_EMAIL)) {////////////////Se estiver no e-mail do IFSC/////////////////
    template = HtmlService.createTemplateFromFile("page");


//Diz para o HTML se ele pertence ao GAS ou se é um HTML externo (aí loga pela API do Google)
      template.treco = UTILIZAR_DO_GET;         // no arquivo HTML vai: let a =  <?!= treco ?> 



    template = template.evaluate();


    


 } else{ 

  var htmlNaoLogado = `
    <!DOCTYPE html>
     <html lang="pt-br">
      <head>
        <meta charset="UTF-8">
        <title>Acesso Restrito</title>
        <style>
          body { margin: 0; padding: 0; background: linear-gradient(to right, #e0f7fa, #e1f5fe); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; color: #333; }
          .card { background: white; padding: 30px 40px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); text-align: center; max-width: 400px; }
          .card h1 { font-size: 1.5em; margin-bottom: 15px; color: #00695c; }
          .card p { font-size: 1em; margin-bottom: 20px; }
          .card a { display: inline-block; padding: 10px 20px; background-color: #00796b; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; transition: background-color 0.3s ease; } 
          .card a:hover { background-color: #004d40; }
        </style>
      </head>
      <body>
        <div class="card">
          <h1>Use seu e-mail institucional</h1>
          <p>Você está acessando com um e-mail que não pertence ao domínio do IFSC.</p>
          <p>Por favor, utilize seu e-mail institucional do tipo:</p>
          <p><strong>seu.nome@aluno.ifsc.edu.br</strong></p>
          <a href="https://www.google.com/a/ifsc.edu.br/ServiceLogin?passive=1209600&continue=https%3A%2F%2Fscript.google.com%2Fa%2Fmacros%2Fifsc.edu.br%2Fs%2FAKfycbyeUeSNsav4RUIEyOOvHxiiiuc19AQwKraP6Ur6Pq4oKjKgZ5Pm6po1aGGNe-eVzZlD%2Fexec&followup=https%3A%2F%2Fscript.google.com%2Fa%2Fmacros%2Fifsc.edu.br%2Fs%2FAKfycbyeUeSNsav4RUIEyOOvHxiiiuc19AQwKraP6Ur6Pq4oKjKgZ5Pm6po1aGGNe-eVzZlD%2Fexec" target="_blank">
            Fazer login com conta IFSC
          </a>
        </div>
      </body>
     </html>`;    
  template = HtmlService.createHtmlOutput(htmlNaoLogado);

 }
  return template.setTitle('𝔸𝕧𝕒𝕝𝕚𝕒𝕔𝕠𝕖𝕤').setFaviconUrl('https://findicons.com/files/icons/2028/fire_toolbar/256/notes.png');
 
}






/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  FERRAMENTAS  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/


//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\Formata: texto:"1,64" -> num:1.6\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
function floatVtoP(txt,cd){var n=parseFloat(txt.replace(",", "."));return (cd == undefined)?n:n.toFixed(cd);} 

//\\//\\//\\//\\//\\//\\//\\//\\// Data no formato mais cuto: "2025-07-31T19:01:57Z"\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
const dataCurta = d => `${d.toISOString().split('.')[0]}Z`;

//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\Formata: num:1.64 -> texto:"1,6"\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
function floatRoundToWord(n,cd){n=(cd === undefined)?n:n.toFixed(cd);return n.toString().replace(".", ",")} 


//\\//\\//\\//\\//\\//\\//\\//\\//\\//Formata datas como: "23:59:59 de 06/01/2050"//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
Date.prototype.hmsDMA = function(h){ h = this.toString().replace(/(\w+) (\w+) (\w+) (\w+) (.*?) (.*?)$/, '$5 de $3/'+("00" +((this).getMonth()+1)).slice(-2)+'/$4');    return h;};  


//\\//\\//\\//\\//\\//\\//\\//\\//\\//Arredondar X com N casas decimais//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
const round_X_N = (x,n) => Math.round(x * 10**n) / (10**n);








function consolePlanilha(...mensagem) {
  
      Logger.log(mensagem[0]);

      if(!SALVAR_REGISTROS_EM_PLANILHA) return;
      
      try {
        const paginaLog = PLANILHA.getSheetByName("LogsPSE");

        paginaLog.insertRows(2);

        paginaLog.getRange(2, 1, 1, 2).setValues([[new Date(), JSON.stringify(mensagem)]]);


        // Se houver mais de 30 linhas, exclui as mais antigas.
        const totalLinhas = paginaLog.getLastRow();
        if (totalLinhas > 20) {      paginaLog.deleteRows(21, totalLinhas - 20);    }


      } catch (e) {
        // Se não conseguir logar na planilha, loga no sistema padrão para não quebrar a execução.
        Logger.log(`FALHA AO LOGAR NA PLANILHA: ${e.toString()}. Mensagem original: ${mensagem}`);
      }
  
}







/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  FUNÇÕES DE USO GERAL  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/







var avalAlunos,aluno;     

function dadosIniciais(linha_aluno/*,mailCapturado,mail, questaoEmAula,n_vinculo*/) {//linha_aluno vai ser o número do vínculo para aluno em mais de uma turma. Ex.: 1, 2 ou 3. Aí recalcula as ocorrências
  // mailCapturado =  "ezequiel.melo@ifsc.edu.br";
  // mail = mail || mailCapturado;  //if(mail == undefined){var mail = capturarEmail_AE_7_8_25();/*"ezequiel.melo@ifsc.edu.br"*/ };
  //let = linha_aluno = dados[0],mailCapturado = dados[1]; //capturarEmail_AE_7_8_25();

  avalAlunos = avalAlunos || PLANILHA.getSheetByName(PAGINA).getRange("B9:FJ").getValues(); //excluir l
    
  var permissoes,dadosTurma,aluno,linha_dadosTurma,listaEmailHTML = ""; 

  
  if(EMAILCHEFE.includes(E_MAIL_DETECTADO)||EMAILOLHADOR.includes(E_MAIL_DETECTADO)){   //Se for o chefe
    permissoes = (EMAILCHEFE.includes(E_MAIL_DETECTADO))?"editor":"leitor";
    linha_aluno = linha_aluno || 9;
    aluno = avalAlunos[linha_aluno];
    linha_dadosTurma = 9;
    dadosTurma = avalAlunos.slice(linha_dadosTurma - 9, linha_dadosTurma - 1);
    //////////////////////Cria lista de e-mails para escolha////////////////////////
    //ADICIONAR ÍNDICE E NOME
    listaEmailHTML = "<input id='mailselected' list='opcoes_mail' name='browser' placeholder='Digite aqui' onClick='this.select();' onchange='atualizarTabela(this.nextElementSibling.value=this.value.split(\":\")[1]);' autocomplete='off'><datalist id='opcoes_mail'> <option value=\"\" /> ";
    for (var j = 0; j < avalAlunos.length; j++) {
     if(avalAlunos[j][1] === "VINDO"){listaEmailHTML +="<option value='"+avalAlunos[j][3]+":"+j+ "' />"+ 
     (JSON.parse("["+avalAlunos[j][0]+"]")+"").substring(0, 2)+ " || "+avalAlunos[j][2];}
    };  
     
    listaEmailHTML=listaEmailHTML+"</datalist>";  // consolePlanilha(listaEmailHTML);

  }  
  else{   //Se for aluno


  //Encontra as linhas que estão o email e forma um array só com elas
  var linhas_aluno = [];
  avalAlunos.filter(function(linha, idx) { if (linha[2] === E_MAIL_DETECTADO) {    linhas_aluno.push(idx); }   });         
  var nOcorrencias = linhas_aluno.length; //consolePlanilha(linhas_aluno);

  switch (nOcorrencias) { 
    case 0:        consolePlanilha("Fora da lista de alunos"); 

      return ["<h1>O seu e-mail institucional não foi localizado, <br>informe o professor para realizar o registro. </h1><br><a href='https://api.whatsapp.com/send?phone=5548936184720&text=Professor,%20meu%20e-mail%20não%20está%20registrado%20ainda%20...' target='_blank'><img style='width:60px;'' src='https://i.ibb.co/jWKgQGv/Whats.png' ></a>"];          
    break;

    case 1:       consolePlanilha("Normal: Caso tenha apenas um vinculo"); 
            
      aluno = avalAlunos[linhas_aluno[0]];
      // aluno = ocorrencias[n_vinculo]; consolePlanilha(linha_aluno, n_vinculo,ocorrencias,aluno);
      linha_dadosTurma = JSON.parse(aluno[0])[1];
      dadosTurma = avalAlunos.slice(linha_dadosTurma - 9, linha_dadosTurma - 1);
      linha_aluno = linhas_aluno[0];
      avalAlunos = undefined; //Limpa a memória
      // listaEmailHTML = ""; //Só carrega se não for o chefe selecionando(nem é, já que se for e-mail de aluno nem chega aqui)

    break;

    default:     consolePlanilha("Duas turmas: Caso tenha mais de um vinculo");   

      var n_vinculo = linha_aluno || 0; // aluno = avalAlunos[linhas_aluno[n_vinculo]]; // aluno = ocorrencias[n_vinculo];
      aluno = avalAlunos[linhas_aluno[n_vinculo]];         // consolePlanilha(linha_aluno, n_vinculo,ocorrencias,aluno);
      
      linha_dadosTurma = JSON.parse(aluno[0])[1];
      dadosTurma = avalAlunos.slice(linha_dadosTurma - 9, linha_dadosTurma - 1);
      linha_aluno = linhas_aluno[n_vinculo];
      
      listaEmailHTML = `<div style='border: 1px solid #ffffff;border-radius:10px;padding: 4px;margin: 4px 0;'>
      <span style='color:#f0f0f0; font-size:16px; font-weight:bold;'>Selecione a turma: </span> <select id='mailselected' name='browser' onchange='atualizarTabela(this.value);' style='border-radius:6px;'>"
      "<option value='`+ n_vinculo +`'>` + JSON.parse(avalAlunos[linhas_aluno[n_vinculo]][0])[0] + `</option>`;
      for (var j = 0; j < nOcorrencias; j++) {
          if (j != n_vinculo) {
            listaEmailHTML += "<option value='"+j+"'>" + JSON.parse(avalAlunos[linhas_aluno[j]][0])[0] + "</option>";
          }
      }
      listaEmailHTML += "</select></div>";              

    break;
    }

    consolePlanilha(linha_aluno,listaEmailHTML)

      }
            
    var turma = JSON.parse(aluno[0])[0], eMail = aluno[2],nome = aluno[3],antigaSaida = [aluno,listaEmailHTML,permissoes,dadosTurma];
    //consolePlanilha("ABRE: "+nome+turma,eMail,dadosTurma+": FECHA");
 

  var a = aluno, t = dadosTurma//.map(linha => linha.slice(2));
  // console.log(t[6][26] .hmsDMA())
                //CAPTURA DADOS GERAIS  
    
  t[0]=t[0].map(function (item){return (typeof item != "number")?item:Math.round((item + Number.EPSILON) * 100) / 100});//Arredonda os valores numéricos

                //CAPTURA NOTAS DO ALUNO ESPECÍFICO  

  a = a.map(function (item){return (typeof item != "number")?item:Math.round((item + Number.EPSILON) * 100) / 100});      //consolePlanilha(d[0][2]); //Arredonda os valores numéricos

                //CAPTURA TABELA DE VIDEOAULAS DO ALUNO ESPECÍFICO  

    // Date.prototype.hmsDMA = function(h){ h = this.toString().replace(/(\w+) (\w+) (\w+) (\w+) (.*?) (.*?)$/, '$5 de $3/'+("00" +((this).getMonth()+1)).slice(-2)+'/$4');    return h;};  



      //CAPTURA AS AVALIAÇÕES MARCADAS COMO HABILITADAS
  var habilit =[t[1][44],t[1][84],t[1][124],t[1][164]];
  // var habilit =[g[0][38],g[0][74],g[0][110],g[0][146]];

  var pesos   =[[t[0][24], t[0][64], t[0][104],  t[0][144]],//Prova
                [t[0][26], t[0][66], t[0][106],  t[0][146]],//Prática
                [t[0][35], t[0][75], t[0][115], t[0][155]],//Lista
                [t[0][41], t[0][81], t[0][121], t[0][161]]];//Videoaulas



  //VERIFICAR necessidade de tudo isso     //Coloca as avaliações pessoais para os alunos caso elas existam na coluna D
  if(a[4] != ""){  //Ver se a célula da coluna D possui pesos personalizados do tipo: [ [ 6, 1, 2, 1 ],, [ 4, 1, 2, 3 ], [ 4, 4, 1, 1 ] ]
    var avalPessoal = eval(a[4]);    //consolePlanilha(avalPessoal);  //Transforma o texto em array
      // var avalPessoal = eval(d[0][2]);    //consolePlanilha(avalPessoal);  //Transforma o texto em array
    
    function transpor(matriz) {//Transpõe matriz 4 x 4, mesmo com elemento vazio []
      const matrizTransposta = [];
      for (let coluna = 0; coluna < 4; coluna++) {
        matrizTransposta.push([]);
        for (let linha = 0; linha < 4; linha++) {
          matrizTransposta[coluna].push(matriz[linha][coluna]);
        }};     return matrizTransposta;           }
    const avalPessoalTransp = transpor(avalPessoal);    //consolePlanilha(avalPessoalTransp);   //Transpõe o array pra ficar igual o dos pesos

    for(var i = 0; i < 4 ; i++){  // Substitui pessos pessoais em branco pelos pesos coletivos
      for(var j = 0; j < 4 ; j++){  //consolePlanilha(avalPessoalTransp[i][j]);
        if(avalPessoalTransp[i][j]==undefined){   avalPessoalTransp[i][j] = pesos[i][j]   };  
      }  
    };    //consolePlanilha(avalPessoalTransp);

    pesos   = avalPessoalTransp;              //consolePlanilha(pesos);     
  }


  //////////////////////////////////////////////////Prova//////////////////////////////////////////////////
  var p   =    [[t[0].slice(8,16),  t[0].slice(48,56),  t[0].slice(88,96),  t[0].slice(128,136) ],//Pesos
                [t[1].slice(8,16),  t[1].slice(48,56),  t[1].slice(88,96),  t[1].slice(128,136) ],//Índices
                [a.slice(8,16),     a.slice(48,56),     a.slice(88,96),     a.slice(128,136)    ],//Notas da prova
                [a.slice(16,24),    a.slice(56,64),     a.slice(96,104),    a.slice(136,144)    ],//Notas darecuperação
                [t[2].slice(8,16),  t[2].slice(48,56),  t[2].slice(88,96),  t[2].slice(128,136) ],//Descrição
                [a[24],             a[64],              a[104],             a[144]              ]];//Nota total
                

  //////////////////////////////////////////////////Carimbos//////////////////////////////////////////////////
  var c = [parseFloat("0"+a[25]), parseFloat("0"+a[65]), parseFloat("0"+a[105]), parseFloat("0"+a[145]) ];
  // var c = [parseFloat("0"+d[0][21]), parseFloat("0"+d[0][57]), parseFloat("0"+d[0][93]), parseFloat("0"+d[0][129]) ];

  //////////////////////////////////////////////////Experimental//////////////////////////////////////////////////
  var e =[
  //              Habilit     Nome     Prazo              Tarefa   Nota    Coment  Resposta
                [t[1][26] ,,t[2][26] ,t[6][26] .hmsDMA(),t[7][26] ,a[26] ,  a[27] , a[28] ],
                [t[1][29] ,,t[2][29] ,t[6][29] .hmsDMA(),t[7][29] ,a[29] ,  a[30] , a[31] ],
                [t[1][32] ,,t[2][32] ,t[6][32] .hmsDMA(),t[7][32] ,a[32] ,  a[33] , a[34] ],

                [t[1][66] ,,t[2][66] ,t[6][66] .hmsDMA(),t[7][66] ,a[66] ,  a[67] , a[68] ],
                [t[1][69] ,,t[2][69] ,t[6][69] .hmsDMA(),t[7][69] ,a[69] ,  a[70] , a[71] ],
                [t[1][72] ,,t[2][72] ,t[6][72] .hmsDMA(),t[7][72] ,a[72] ,  a[73] , a[74] ],
 
                [t[1][106],,t[2][106],t[6][106].hmsDMA(),t[7][106],a[106],  a[107], a[108]],
                [t[1][109],,t[2][109],t[6][109].hmsDMA(),t[7][109],a[109],  a[110], a[111]],
                [t[1][112],,t[2][112],t[6][112].hmsDMA(),t[7][112],a[112],  a[113], a[114]],

                [t[1][146],,t[2][146],t[6][146].hmsDMA(),t[7][146],a[146],  a[147], a[148]],
                [t[1][149],,t[2][149],t[6][149].hmsDMA(),t[7][149],a[149],  a[150], a[151]],
                [t[1][152],,t[2][152],t[6][152].hmsDMA(),t[7][152],a[152],  a[153], a[154]]];  
  

  //////////////////////////////////////////////////Lista//////////////////////////////////////////////////
  var l=[
  //              Habilit      Nome         Prazo               Nota
                [t[1][35] , ,  t[2][35] ,  t[6][35] .hmsDMA(),((a[36] !='')?   a[36] : a[35]   )],
                [t[1][37] , ,  t[2][37] ,  t[6][37] .hmsDMA(),((a[38] !='')?   a[38] : a[37]   )],
                [t[1][39] , ,  t[2][39] ,  t[6][39] .hmsDMA(),((a[40] !='')?   a[40] : a[39]   )],
            
                [t[1][75] , ,  t[2][75] ,  t[6][75] .hmsDMA(),((a[76] !='')?   a[76] : a[75]   )],
                [t[1][77] , ,  t[2][77] ,  t[6][77] .hmsDMA(),((a[78] !='')?   a[78] : a[77]   )],
                [t[1][79] , ,  t[2][79] ,  t[6][79] .hmsDMA(),((a[80] !='')?   a[80] : a[79]   )],

                [t[1][115] , , t[2][115] , t[6][115].hmsDMA(),((a[116] !='')?  a[116]:a[115]  )],
                [t[1][117] , , t[2][117] , t[6][117].hmsDMA(),((a[118] !='')?  a[118]:a[117]  )],
                [t[1][119] , , t[2][119] , t[6][119].hmsDMA(),((a[120] !='')?  a[120]:a[119]  )],

                [t[1][155], ,  t[2][155],  t[6][155].hmsDMA(),((a[156]!='')?   a[156]:a[155]  )],
                [t[1][157], ,  t[2][157],  t[6][157].hmsDMA(),((a[158]!='')?   a[158]:a[157]  )],
                [t[1][159], ,  t[2][159],  t[6][159].hmsDMA(),((a[160]!='')?   a[160]:a[159]  )]];

               
  var viAu  =   [a[41], a[81], a[121],a[161]];

  var nota  =   [a[44], a[84], a[124],a[164]];

                    // dadosAluno[3] = ;            //consolePlanilha("5555: "+a);
                    //var d = [[ turma, eMail, nome, listaEmailHTML ],habilit,pesos,p,l,e,viAu,nota,c,"o g[3][1] já saiu",notaViAu] ; //g[3][1] é a quantidade de avaliações que terão
                    // var d = [dadosAluno,habilit,pesos,prova,lista,experimental,viAu,nota,c,g[3][1],notaViAu] ; //g[3][1] é a quantidade de avaliações que terão
                    //d=ident[0],habilit[1],pesos[2],prova[3],l[4],e[5],viAu[6],nota[7],c[8],Qdade avaliação[9],videoaula[10]
                    //d[10] = JSON.parse(d[10]);//alert(d[0][  2  ].length);//Transforma o texto em array






  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////CRIAÇÃO DA TABELA /////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////






    var notaViAu = JSON.parse("["+aluno[7]+","+t[0][7]+"]");   //consolePlanilha("viau: ",notaViAu);
    
    var textoTabela = '<div class="identificacao">'+nome+' ('+turma+')</div>'; //alert(d[1][0]+d[1][1]+d[1][2]+d[1][3]);

    for(var i = 0; i<t[3][3]; i++){  //Cria os campos de de avaliação até a quantidade declarada t[3][3]
      var a = i; 
      if(p[i]){   
  ///////////////////////////////////////////////////// Título //////////////////////////////////////////////////////////
  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        var nTitulo = '<input type="radio" name="aba" id="aba'+(i+1)+'" class="abaestilo" '+((i==(habilit[0]+habilit[1]+habilit[2]+habilit[3])-1)?'checked':'')+'> <label '+((habilit[i]==true)?'for="aba'+(i+1)+'"':'style="background:lightgray"')+' class="abaestilo" > <a style="float:left;">☑</a>'+(i+1)+'ª NOTA <b class="nota">'+nota[i]+'</b> </label> <div class="aba">';


  /////////////////////////////////////////////////////Videoaula //////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //Função repetir texto para gerar tabela (texto de entrada: £¢ → (1,2,...) e §§ →texto no notaViAu[2][0][f], nº ciclos, texto de notaViAu[2][0][f])
        function nRepeTextIndex(tIn,nCiclos,enderTextualDaVar,ee){ 
          let tOut='';
          for(let f=0;f<nCiclos;f++){ 

            var ggg = eval(enderTextualDaVar);   
            //if(ggg != "-"){
              tOut += (tIn.replaceAll(/£¢/g,("00" +(f+1)).slice(-2)))  //Índice numerico
                                .replaceAll(/§§/g,ggg)   //Substitui pelo valor encontrado em "endereço Textual da Variável" 
                                .replaceAll(/〸/g,eval(ee))  // "ee" é similar a "ggg"
            //}
          };
          return tOut;
        }
        
        var nViAu = '<div id="videoaula1" style="display:'+((pesos[3][i]==0)?'none':'block')+'"> <label class="avaliacoes" style="background:rgba(222,152,56,255)"> <b class="percentnota">'+(pesos[3][i]*10)+'% da nota</b> &nbsp&nbsp&nbsp Videoaula  &nbsp&nbsp&nbsp <b class="nota">'+(10*viAu[i]).toFixed(2)+'<b style="color:rgba(222,152,56,25);"> de 10</b></b> </label>'
        + '<table class="table-aba" id="nota1"><tr style="background: rgba(222,152,56,0.2)">'
        + nRepeTextIndex('<td  class="linkint" onclick="videoaula(£¢,〸)"><span>£¢</span><div class="tooltip">💬<span class="tooltiptext">§§</span></div></td>\n', notaViAu[2][i].length, "notaViAu[2][i][f][0]", "notaViAu[2][i][f][1]")
        + '</tr> <tr>' 
        + nRepeTextIndex('<td>§§%</td>', notaViAu[2][i].length, "notaViAu[0][i][f]||0") //notaViAu[0][i][f] são as notas percent.
        +'</table>'+'</div>';

  /////////////////////////////////////////////////  Experimental ////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        var nExperimental = '<div id="experimental1" style="display:'+((pesos[1][i]==0)?'none':'block')+'"> <label class="avaliacoes" style="background:rgba(1,90,108,255);"> <b class="percentnota">'+pesos[1][i]*10+'% da nota</b> &nbsp&nbsp&nbsp Prática experimental  &nbsp&nbsp&nbsp <b class="nota">'+ ((parseFloat((e[0+i*3][0]==true)?"0"+e[0+i*3][5]:0)+parseFloat((e[1+i*3][0]==true)?"0"+e[1+i*3][5]:0)+parseFloat((e[2+i*3][0]==true)?"0"+e[2+i*3][5]:0))/((((e[0+i*3][0]==true)?1:0)+((e[1+i*3][0]==true)?1:0)+((e[2+i*3][0]==true)?1:0)))).toFixed(2).replace(/^NaN$/, "0.00") +'<b style="color:rgba(1,90,108,255);"> de 10</b></b> </label>'
        +'<table class="table-aba" id="notaE"> <tr style="background: rgba(1,90,108,0.2)">'
        +((e[0+i*3][0]==true)?'<td class="linkint" onclick="experimental('+(0+i*40)+',\''+e[0+i*3][4]+'\',\''+e[0+i*3][5]+'\',\''+e[0+i*3][6]+'\',\''+((e[0+i*3][7].includes("~"))?e[0+i*3][7].split("~")[1]:"")+'\',\''+e[0+i*3][3]+'\');" href="'+e[0+i*3][4]+'">'+e[0+i*3][2]+'<div class="tooltip"> 💬<span class="tooltiptext"> até ' + e[0+i*3][3] + '</span></div></td>':'') 
        +((e[1+i*3][0]==true)?'<td class="linkint" onclick="experimental('+(3+i*40)+',\''+e[1+i*3][4]+'\',\''+e[1+i*3][5]+'\',\''+e[1+i*3][6]+'\',\''+((e[1+i*3][7].includes("~"))?e[1+i*3][7].split("~")[1]:"")+'\',\''+e[1+i*3][3]+'\');" href="'+e[1+i*3][4]+'">'+e[1+i*3][2]+'<div class="tooltip"> 💬<span class="tooltiptext"> até ' + e[1+i*3][3] + '</span></div></td>':'') 
        +((e[2+i*3][0]==true)?'<td class="linkint" onclick="experimental('+(6+i*40)+',\''+e[2+i*3][4]+'\',\''+e[2+i*3][5]+'\',\''+e[2+i*3][6]+'\',\''+((e[2+i*3][7].includes("~"))?e[2+i*3][7].split("~")[1]:"")+'\',\''+e[2+i*3][3]+'\');" href="'+e[2+i*3][4]+'">'+e[2+i*3][2]+'<div class="tooltip"> 💬<span class="tooltiptext"> até ' + e[2+i*3][3] + '</span></div></td>':'') 
        +'</tr><tr>'
        +((e[0+i*3][0]==true)?'<td style="'+((e[0+i*3][5]<6)?'color:red':'')+'">'+((e[0+i*3][5]=="")?((e[0+i*3][7] !="")?"Ainda não corrigido":"Não enviado"):e[0+i*3][5])+'</td>':'')
        +((e[1+i*3][0]==true)?'<td style="'+((e[1+i*3][5]<6)?'color:red':'')+'">'+((e[1+i*3][5]=="")?((e[1+i*3][7] !="")?"Ainda não corrigido":"Não enviado"):e[1+i*3][5])+'</td>':'')
        +((e[2+i*3][0]==true)?'<td style="'+((e[2+i*3][5]<6)?'color:red':'')+'">'+((e[2+i*3][5]=="")?((e[2+i*3][7] !="")?"Ainda não corrigido":"Não enviado"):e[2+i*3][5])+'</td>':'')
        +'</tr> </table> </div>'

  ///////////////////////////////////////////////////// Listas //////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        var nLista = '<div id="listas1" style="display:'+((pesos[2][i]==0)?'none':'block')+'"> <label class="avaliacoes" style="background:rgba(222,152,56,255);"> <b class="percentnota">'+pesos[2][i]*10+'% da nota</b>Listas de exercícios<b class="nota">' 
        +((parseFloat((l[0+i*3][0]==true)?l[0+i*3][4]:0)+parseFloat((l[1+i*3][0]==true)?l[1+i*3][4]:0)+parseFloat((l[2+i*3][0]==true)?l[2+i*3][4]:0))/((((l[0+i*3][0]==true)?1:0)+((l[1+i*3][0]==true)?1:0)+((l[2+i*3][0]==true)?1:0)))).toFixed(2).replace(/^NaN$/, "0.00") 
        +'<b style="color:rgba(222,152,56,255);"> de 10</b></b> </label>'
        +'<table class="table-aba" id="notaL"> <tr style="background:rgba(222,152,56,0.2)">'
        +((l[0+i*3][0]==true)?'<td class="linkint" onclick="chamarlista('+(1+i*3)+',\''+turma+'\')">'+1+'ª Lista<div class="tooltip"> 💬<span class="tooltiptext"> ' + l[0+i*3][3] + '</span></div></td>':'') 
        +((l[1+i*3][0]==true)?'<td class="linkint" onclick="chamarlista('+(2+i*3)+',\''+turma+'\')"">'+2+'ª Lista<div class="tooltip"> 💬<span class="tooltiptext"> ' + l[1+i*3][3] + '</span></div></td>':'') 
        +((l[2+i*3][0]==true)?'<td class="linkint" onclick="chamarlista('+(3+i*3)+',\''+turma+'\')">'+3+'ª Lista<div class="tooltip"> 💬<span class="tooltiptext"> ' + l[2+i*3][3] + '</span></div></td>':'') 
        +'</tr><tr>'
        +((l[0+i*3][0]==true)?'<td style="'+((l[0+i*3][4]<6)?'color:red':'')+'">'+l[0+i*3][4]+'</td>':'')
        +((l[1+i*3][0]==true)?'<td style="'+((l[1+i*3][4]<6)?'color:red':'')+'">'+l[1+i*3][4]+'</td>':'')
        +((l[2+i*3][0]==true)?'<td style="'+((l[2+i*3][4]<6)?'color:red':'')+'">'+l[2+i*3][4]+'</td>':'')
        +'</tr> </table> </div>';

  ///////////////////////////////////////////////////// Prova //////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        var nProva = '<div id="prova1" style="display:'+((pesos[0][i]==0)?'none':'block')+'"> <label class="avaliacoes" style="background:rgba(1,90,108,255);"> <b class="percentnota">'+pesos[0][i]*10+'% da nota</b> &nbsp&nbsp&nbsp Prova escrita  &nbsp&nbsp&nbsp <b class="nota">'+(p[5][i]).toFixed(2)+'<b style="color:rgba(1,90,108,255);"> de 10</b></b> </label>'
        +'<table class="table-aba" id="notaP">'
        +'<tr style="background: rgba(1,90,108,0.3)"><td>Questão</td>'
        +((p[0][i][0]>0)?'<td>'+p[1][i][0] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][0] + '</span></div></td>':'')
        +((p[0][i][1]>0)?'<td>'+p[1][i][1] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][1] + '</span></div></td>':'')
        +((p[0][i][2]>0)?'<td>'+p[1][i][2] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][2] + '</span></div></td>':'')
        +((p[0][i][3]>0)?'<td>'+p[1][i][3] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][3] + '</span></div></td>':'')
        +((p[0][i][4]>0)?'<td>'+p[1][i][4] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][4] + '</span></div></td>':'')
        +((p[0][i][5]>0)?'<td>'+p[1][i][5] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][5] + '</span></div></td>':'')
        +((p[0][i][6]>0)?'<td>'+p[1][i][6] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][6] + '</span></div></td>':'')
        +((p[0][i][7]>0)?'<td>'+p[1][i][7] +'<div class="tooltip"> 💬<span class="tooltiptext"> ' + p[4][i][7] + '</span></div></td>':'')+ '</tr>' 
        +'<tr style="background: rgba(1,90,108,0.1)">'
        +'<td style="background: rgba(1,90,108,0.3)">Peso</td>'
        +((p[0][i][0]>0)?'<td>'+ p[0][i][0] +'</td>':'')
        +((p[0][i][1]>0)?'<td>'+ p[0][i][1] +'</td>':'')
        +((p[0][i][2]>0)?'<td>'+ p[0][i][2] +'</td>':'')
        +((p[0][i][3]>0)?'<td>'+ p[0][i][3] +'</td>':'')
        +((p[0][i][4]>0)?'<td>'+ p[0][i][4] +'</td>':'')
        +((p[0][i][5]>0)?'<td>'+ p[0][i][5] +'</td>':'')
        +((p[0][i][6]>0)?'<td>'+ p[0][i][6] +'</td>':'')
        +((p[0][i][7]>0)?'<td>'+ p[0][i][7] +'</td>':'')
        +'</tr>'+ '<tr><td style="background: rgba(1,90,108,0.3)">Prova<div class="tooltip"> 💬<span class="tooltiptext"> ' 
        +'<a href="https://yt3.ggpht.com/ytc/AMLnZu8A4nuEbtWWNfHf3haxvACgs0LLdqOmeM69nWDw=s900-c-k-c0x00ffffff-no-rj" target="_blank">Nada por aqui</a>' + '</span></div></td>'
        +((p[0][i][0]>0)?'<td style="'+((p[2][i][0]<p[3][i][0])?'text-decoration:line-through;':'')+((p[2][i][0]<6)?'color:red':'')+'">'+p[2][i][0]+'</td>':'')
        +((p[0][i][1]>0)?'<td style="'+((p[2][i][1]<p[3][i][1])?'text-decoration:line-through;':'')+((p[2][i][1]<6)?'color:red':'')+'">'+p[2][i][1]+'</td>':'')
        +((p[0][i][2]>0)?'<td style="'+((p[2][i][2]<p[3][i][2])?'text-decoration:line-through;':'')+((p[2][i][2]<6)?'color:red':'')+'">'+p[2][i][2]+'</td>':'')
        +((p[0][i][3]>0)?'<td style="'+((p[2][i][3]<p[3][i][3])?'text-decoration:line-through;':'')+((p[2][i][3]<6)?'color:red':'')+'">'+p[2][i][3]+'</td>':'')
        +((p[0][i][4]>0)?'<td style="'+((p[2][i][4]<p[3][i][4])?'text-decoration:line-through;':'')+((p[2][i][4]<6)?'color:red':'')+'">'+p[2][i][4]+'</td>':'')
        +((p[0][i][5]>0)?'<td style="'+((p[2][i][5]<p[3][i][5])?'text-decoration:line-through;':'')+((p[2][i][5]<6)?'color:red':'')+'">'+p[2][i][5]+'</td>':'')
        +((p[0][i][6]>0)?'<td style="'+((p[2][i][6]<p[3][i][6])?'text-decoration:line-through;':'')+((p[2][i][6]<6)?'color:red':'')+'">'+p[2][i][6]+'</td>':'')
        +((p[0][i][7]>0)?'<td style="'+((p[2][i][7]<p[3][i][7])?'text-decoration:line-through;':'')+((p[2][i][7]<6)?'color:red':'')+'">'+p[2][i][7]+'</td>':'')
        +'</tr> <tr><td style="background: rgba(1,90,108,0.3)">Recup.<div class="tooltip"> 💬<span class="tooltiptext"> ' + '<a href="https://yt3.ggpht.com/ytc/AMLnZu8A4nuEbtWWNfHf3haxvACgs0LLdqOmeM69nWDw=s900-c-k-c0x00ffffff-no-rj" target="_blank">Nada por aqui</a>' + '</span></div></td>'
        +((p[0][i][0]>0)?'<td style="'+((p[2][i][0]>=p[3][i][0])?'text-decoration:line-through;':'')+((p[3][i][0]<6)?'color:red':'')+'">'+p[3][i][0]+'</td>':'')
        +((p[0][i][1]>0)?'<td style="'+((p[2][i][1]>=p[3][i][1])?'text-decoration:line-through;':'')+((p[3][i][1]<6)?'color:red':'')+'">'+p[3][i][1]+'</td>':'')
        +((p[0][i][2]>0)?'<td style="'+((p[2][i][2]>=p[3][i][2])?'text-decoration:line-through;':'')+((p[3][i][2]<6)?'color:red':'')+'">'+p[3][i][2]+'</td>':'')
        +((p[0][i][3]>0)?'<td style="'+((p[2][i][3]>=p[3][i][3])?'text-decoration:line-through;':'')+((p[3][i][3]<6)?'color:red':'')+'">'+p[3][i][3]+'</td>':'')
        +((p[0][i][4]>0)?'<td style="'+((p[2][i][4]>=p[3][i][4])?'text-decoration:line-through;':'')+((p[3][i][4]<6)?'color:red':'')+'">'+p[3][i][4]+'</td>':'')
        +((p[0][i][5]>0)?'<td style="'+((p[2][i][5]>=p[3][i][5])?'text-decoration:line-through;':'')+((p[3][i][5]<6)?'color:red':'')+'">'+p[3][i][5]+'</td>':'')
        +((p[0][i][6]>0)?'<td style="'+((p[2][i][6]>=p[3][i][6])?'text-decoration:line-through;':'')+((p[3][i][6]<6)?'color:red':'')+'">'+p[3][i][6]+'</td>':'')
        +((p[0][i][7]>0)?'<td style="'+((p[2][i][7]>=p[3][i][7])?'text-decoration:line-through;':'')+((p[3][i][7]<6)?'color:red':'')+'">'+p[3][i][7]+'</td>':'')
        +'</tr></table></div>';

  ///////////////////////////////////////////////////// Carimbos //////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        var nCarimbo = '<div id="carimbo1" style="display:block"> <label class="avaliacoes" style="background:rgba(222,152,56,255);"> <b class="percentnota">Extra</b> &nbsp&nbsp&nbsp Carimbos  &nbsp&nbsp&nbsp <b class="nota">+ '+c[i]+'<b style="color:rgba(222,152,56,255);"> × 0,25</b></b></label></div>';



  ///////////////////////////////////////////// Junção das partes da tabela ///////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        var textoTabela = textoTabela + '<div class="abas">' + nTitulo + nViAu + nExperimental + nLista + nProva + nCarimbo + '</div>';                  // consolePlanilha(textoTabela);
      }


    };
                //dadosGeraisAluno = [d[0][0],d[0][1],d[0][2],d[0][3]]; //["turma","e-mail","nome","lista suspensa de e-mails"]
                    //  consolePlanilha(dadosGeraisAluno);
                // dadosGeraisAluno = [JSON.parse(aluno[0])[0],aluno[2],aluno[3],d[0][3],listaEmailHTML,JSON.parse(aluno[0])[1]]; //["turma","e-mail","nome","lista suspensa de e-mails",linha]


  //["turma","e-mail","nome","lista suspensa de e-mails",linha]                
  var dadosGeraisAluno = [turma,eMail,nome,linha_dadosTurma,linha_aluno,listaEmailHTML];        // consolePlanilha(dadosGeraisAluno);

  textoTabela +=  '<div id="armazem" '+
                  'nome="'+nome+'"'+
                  'eMail="'+eMail+'"'+
                  'turma="'+turma+'"'+
                  'row_al="'+linha_aluno+'"'+
                  'row_DT="'+linha_dadosTurma+'"'+
                  '>Espaço para salvar dados (ocultar)</div>';  //"perguntasvid" está apenas para guardar dados.







  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ///////////////////////////////////////////ADICIONA OU NÃO O QEA///////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  let dado_QEA = PLANILHA.getSheetByName(PAGINA).getRange("FS6:FW8").getValues(), saidaQEA;
  //(  Se foi encontrado      && Se QEA visível   && Se é da turma selecionada           && Se tá no prazo )
  if(nome.length > 0 && (dado_QEA[0][0]) && (dado_QEA[0][1]==turma) && (dado_QEA[0][3]>new Date())){ consolePlanilha("foi");
  
              //[turma,email,nome,linha_aluno,[TEXTO QUESTÃO,  1A2⟹AULA,      nQUESTÃO,      PRAZO,         nCARIMBOS]]
    let aluno = [turma,eMail,nome,linha_aluno,[dado_QEA[2][3],dado_QEA[2][0],dado_QEA[0][2],dado_QEA[0][3],dado_QEA[0][4]]];
    saidaQEA = puxarQEA(aluno); //[TEXTO QUESTÃO,VARIÁVEIS,1A2⟹AULA,Nº DA QUESTÃO,PRAZO,LINHA DO ALUNO] 
  }  else {  saidaQEA = false;       }  







   return [textoTabela,turma,eMail,nome,linha_dadosTurma,linha_aluno,listaEmailHTML,saidaQEA];
      
}
















































/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>  GERADOR DE QUESTÕES PERSONALIZADAS  <<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/



///////////////////Recebe cada questão no formato do BQ e envia pra "substitui()", era feito na planilha ///////////////////
function prepararQuestao(quest,somaPesos,tipoQuestao,mail,nTentativa,nQuestao,nQuestaoBanco){
  //Adicionar substituir os "⟪££⟫" por números em sequência na função da lista que chama o preparrarQuestao().
  nQuestao = nQuestao ||"££"; nQuestaoBanco = nQuestaoBanco || ""//  console.log("");
  //////////Configura diferente se a solicitação é de lista ou vídeo///////////
  switch (tipoQuestao) { 
    case "lista":      
      var ident = "",  ident2 = nQuestao, 
          textOpcional = ((nQuestaoBanco.includes("*"))?"<span style='color:orange;'> ⇒ OPCIONAL (potuação extra em 10% da exibida).<br></span> ":"");
          nQuet = " ⟪"+nQuestao+"⟫ <b style='color:Gray;'>["+floatRoundToWord(somaPesos,1)+"]</b> " + textOpcional;     
    break;
    case "video":      var ident = "VD",  ident2 = "VD", nQuet = "";                                        break;
    case "qEmAula":    var ident = "QEA", ident2 = "QEA", nQuet = "";                                       break;
    default:                                                                                                break;
    }



  //////////Coloca em um array os dados do título da qestão (Q~~Q)///////////
  var chaveQ = quest.match(/(?<=\(Q~).*?[^\n](?=~Q\))/g)[0].split('~');  //(Q~Tempo~Vídeo ajuda 1|Vídeo ajuda 2~ ~Imagem~Altura~Q)
      //consolePlanilha(chaveQ);


  //////////Retira o título da qestão (Q~~Q), e tbm o (A~~A)///////////
  var semChavesQA = quest.replace(/(\([QA]~.*?~[QA]\)(<br>)?)/g,""); //consolePlanilha(quest+"\n\n\n"+semChavesQA) 
    
  //////////Edita a parte comum a todos os tipos de formulários NUM,REG,LS,E,OU e VF///////////
  var questSaida = `<p><img src='` + chaveQ[3] + `' height='` + chaveQ[4] + `px' align='right' style='display:block;filter:drop-shadow(1px 1px 7px white);padding:10px;'>` + nQuet;
  
    //////////Coloca em um array os geradores de formulário (F~~F)///////////
    var chavesF = quest.match(/(\(F~.*?[^\n]~F\))/g);      //consolePlanilha(chavesF) 


  /////////////////////////////////////////Filtra o tipo "NUM|REG|LS"////////////////////////////////////
  ///////////////////////////////////////////////////////////////////////////////////////////////////////
  if (/\(F~.*?~.*?~NUM|REG|LS~.*?~.*?~.*?~.*?~.*?~F\)/.test(quest)) {  

    //////////Coloca N~01🠚 nos geradores numéricos para ficar compatível com o 🠚 da função Substituir ()///////////
    questSaida = (questSaida + semChavesQA).replace(/(\(N~)/g,"(N~"+nQuestao+"🠚");
    
    //////////Varre por todos os formulários (F~~F) encontrados na questão/////////// 
    for(var i = 0; i < chavesF.length; i++){

      //////////Separa em um array os dados da chave (F~~F)///////////
      var arrayF = chavesF[i].split('~');    //consolePlanilha(arrayF)

      //////////Peso percentual de cada input com base no peso total, usa a função criada floatVtoP()///////////
      var peso = (100*floatVtoP(arrayF[2])/somaPesos).toFixed(1); 
      var textopeso = "✓(+ "+ peso + "%) ou  メ(- " + (-peso*floatVtoP(arrayF[6])/100).toFixed(1) + "%)"; //✓(+ 4.2%) ou  メ(- 4.2%)

      //////////Monta o restante do 'questSaida' com o texto de cada tipo de formulário///////////
      switch (arrayF[3]) { 
          case "NUM": 
            //////////Substitui cada formulário por seu input HTML///////////
            questSaida =  questSaida.replace(chavesF[i],`<span class='answer'><input class='inputes`+ ident + `' type='text' id='`+ ident2 + `🠚id{` + arrayF[1] + `}' pattern='^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$$' placeholder='` + arrayF[4] + `'/>  <b></b>  <sup class='peso'>` + textopeso + `</sup></span>`);
          break;
          case "REG": 
            questSaida =  questSaida.replace(chavesF[i],`<span class='answer'><input class='inputes`+ ident + `' type='text' id='`+ ident2 + `🠚id{` + arrayF[1] + `}' pattern='`   + arrayF[5].replace(/\$/g, "$$$") + `' placeholder='` + arrayF[4] + `'/>  <b></b>  <sup class='peso'>` + textopeso + `</sup></span>`);
          break;
          case "LS":     
            questSaida =  questSaida.replace(chavesF[i],`<span class='answer'><select class='inputes`+ ident + `' id='`+ ident2 + `🠚id{` + arrayF[1] + `}'><option value=''>- - -  -</option>`+arrayF[5].replace(/\{<(.*?)>\}/g, function (match, p1) {return `<option value="${p1}">${p1}</option>`;})+`</select>  <sup class='peso'>` + textopeso + `</sup></span>`);
          break;

          default: 
          break;
          }}
         } 

  /////////////////////////////////////////Filtra o tipo "OU"////////////////////////////////////
  ///////////////////////////////////////////////////////////////////////////////////////////////
  else if (/\(F~.*?~.*?~OU~.*?~.*?~.*?~.*?~.*?~F\)/.test(quest))    {  
    ////////Cabeçalho e cálculo dos pesos apenas pela primeira das chaves (A~~A)////////
      // var peso = (100*floatVtoP(chavesF[0].split('~')[2])/somaPesos).toFixed(1);
      var arrayF0 = chavesF[0].split('~');
      var peso = (100*floatVtoP(arrayF0[2])/somaPesos).toFixed(1); 
      var textopeso = "✓(+ "+ 100 + "%) ou  メ(- " + (-100*floatVtoP(arrayF0[6])/100).toFixed(1) + "%)"; //✓(+ 4.2%) ou  メ(- 4.2%)
      //////////Tirei por causa das listas, avaliar se foi melhor escolha///////////
      // var textopeso = "✓(+ "+ peso + "%) ou  メ(- " + (-peso*floatVtoP(arrayF0[6])/100).toFixed(1) + "%)"; //✓(+ 4.2%) ou  メ(- 4.2%)
      // consolePlanilha(textopeso)

    questSaida += `<span class="answer">` + semChavesQA.replaceAll("<br>","") + `<button class="limpar" onclick="document.getElementsByName('`+ ident2 + `').forEach(function(c){(c.disabled == true)?c.disabled = false:c.disabled = true;});">Isenção</button><sup class='peso'>` + textopeso + `</sup></span>`;
    
    ////////Busca as chaves (A~~A)////////
    var chavesA = quest.match(/(\(A~.*?[^\n]~A\))/g);      //consolePlanilha("quest:"+quest);//	consolePlanilha(chaveA);

    //////////Varre por todas as chaves (A~~A) encontrados na questão/////////// 
    for(var i = 0; i < chavesA.length; i++){

          ////////Deixa só o enunciado da alternativa/////////////
          semChaveF = chavesA[i].match(/(?<=\(A~).*?[^\n](?=\(F~.*?~A\))/g)[0];													//consolePlanilha(semChaveF);
          ////////Abre a chave (A~~A) em um array para retira id/////////////
          var arrayA = chavesA[i].split('~');																													// consolePlanilha(arrayA[2]);
          questSaida = questSaida + `\n<br>(A~<input type='radio' class='inputes`+ ident + `' name='`+ ident2 + `' id='`+ ident2 + `🠚id{` + arrayA[2] + `}' value='` + arrayA[2] + `'>  <label          for='`+ ident2 + `🠚id{` + arrayA[2] + `}'>`+ semChaveF + `</label>~A)`;
    }
         } 

  /////////////////////////////////////////Filtra o tipo "E"/////////////////////////////////////
  ///////////////////////////////////////////////////////////////////////////////////////////////
  else if (/\(F~.*?~.*?~E~.*?~.*?~.*?~.*?~.*?~F\)/.test(quest))     {        
    questSaida = (questSaida + semChavesQA.replaceAll("<br>","") + `  <button class='limpar' onclick="document.getElementsByName('`+ ident2 + `').forEach(function(c){(c.disabled == true)?c.disabled = false:c.disabled = true;});" >Isenção</button><br>`);//consolePlanilha("questSaida:"+questSaida);

    ////////Busca as chaves (A~~A)////////
    var chavesA = quest.match(/(\(A~.*?[^\n]~A\))/g);      //consolePlanilha("quest:"+quest);//	consolePlanilha(chaveA);

    //////////Varre por todas as chaves (A~~A) encontrados na questão/////////// 
    for(var i = 0; i < chavesA.length; i++){
    // consolePlanilha("aaaa"+quest.replace(chavesF[i],`OI`))

      ////////Deixa só o enunciado da alternativa/////////////
      semChaveF = chavesA[i].match(/(?<=\(A~).*?[^\n](?=\(F~.*?~A\))/g)[0];													//consolePlanilha(semChaveF);

      ////////Abre a chave (A~~A) em um array para retira id/////////////
      var arrayF = chavesF[i].split('~');																													 //consolePlanilha(arrayF);

      var peso = (100*floatVtoP(arrayF[2])/somaPesos).toFixed(1); 
      var textopeso = "✓(+ "+ peso + "%) ou  メ(- " + (-peso*floatVtoP(arrayF[6])/100).toFixed(1) + "%)"; //✓(+ 4.2%) ou  メ(- 4.2%)

      questSaida = questSaida +`(A~<span class='answer'><input type='checkbox' class='inputes`+ ident + `' name='`+ ident2 + `' id='`+ ident2 + `🠚id{` + arrayF[1] + `}' value='` + arrayF[1] + `'> <label for='`+ ident2 + `🠚id{` + arrayF[1] + `}'>` + semChaveF + `</label>     <sup class='peso'>` + textopeso + `</sup></span><br>~A)`;
    }
    questSaida = questSaida.replace(/(\(P~)/g,"(P~"+ ident2 + "🠚");          //consolePlanilha("questSaida:"+questSaida);
        } 



  /////////////////////////////////////////Filtra o tipo "VF"////////////////////////////////////
  ///////////////////////////////////////////////////////////////////////////////////////////////
  else if (/\(F~.*?~.*?~VF~.*?~.*?~.*?~.*?~.*?~F\)/.test(quest))    {     

    //////////Coloca N~01🠚 nos geradores numéricos para ficar compatível com o 🠚 da função Substituir ()///////////
    questSaida = (questSaida + semChavesQA.replaceAll("<br>",""));          //consolePlanilha("questSaida:"+questSaida);
    
    ////////Busca as chaves (A~~A)////////
    var chavesA = quest.match(/(\(A~.*?[^\n]~A\))/g);      //consolePlanilha("quest:"+quest);//	consolePlanilha(chaveA);

    //////////Varre por todas as chaves (A~~A) encontrados na questão/////////// 
    for(var i = 0; i < chavesA.length; i++){
    // consolePlanilha("aaaa"+quest.replace(chavesF[i],`OI`))

      ////////Deixa só o enunciado da alternativa/////////////
      semChaveF = chavesA[i].match(/(?<=\(A~).*?[^\n](?=\(F~.*?~A\))/g)[0];													//consolePlanilha(semChaveF);

      ////////Abre a chave (A~~A) em um array para retira id/////////////
      var arrayF = chavesF[i].split('~');																													 //consolePlanilha(arrayF[1]);

      var peso = (100*floatVtoP(arrayF[2])/somaPesos).toFixed(1); 
      var textopeso = "✓(+ "+ peso + "%) ou  メ(- " + (-peso*floatVtoP(arrayF[6])/100).toFixed(1) + "%)"; //✓(+ 4.2%) ou  メ(- 4.2%)

      questSaida = questSaida +`\n<br>` + chavesA[i].replace(chavesF[i],`<span class='answer'><select class='inputes`+ ident + `' id='`+ ident2 + `🠚id{` + arrayF[1] + `}'> <option value=''>- - - -<option value='true'>Verdadeira<option value='false'>Falsa</select><sup class='peso'>` + textopeso + `</sup></span>`);
    }
    questSaida = questSaida.replace(/(\(P~)/g,"(P~"+ ident2 + "🠚");          //consolePlanilha("questSaida:"+questSaida);
       } 
  else {        
    questSaida = `Houve um erro na digitação da questão, comunicar o professor`;
      }
















  var substituido = substitui(questSaida + `</p>`,mail,nTentativa);



















        //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////PREPARA O GABARITO PARA O CHEFE//////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////
        //let a = [quest,somaPesos,tipoQuestao,mail,nTentativa,nQuestao,nQuestaoBanco];
  let solucaoChefe = "";
  //////////Só funciona se for o chefe logado////////////
  if(EMAILCHEFE.includes(E_MAIL_DETECTADO)){
    solucaoChefe = `<meugab id="r-`+nQuestao+`"><button onclick="var t = document.getElementById('rtxt-`+nQuestao+`'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';">R-`+nQuestao+`</button><meugabtxt  id="rtxt-`+nQuestao+`" onfocus="sinalizarParenteses(this)"  onmouseup="corrigirPorSelecao(this)"  contenteditable="true" style="white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;width: 500px;height: 100px;font-size: 13px;display:none;">           <b style='color:Green;'>` 
    + 
    substituido[1].map((item) => item[0].replace(/⦅.*?🠚(.*?)🠖(.*?)⦆/,"([$1=$2])")).join(" ") + `<br>`
    +
    chavesF.map(function(item){a=item.split('~');return `</b><b style='color:black;'>`+a[1]+`: </b>`+a[8]; }).join("<br>")
    +
    ((nQuestaoBanco)?`<br><b style='color:red;'>BQ:`+ nQuestaoBanco +`</b>` :"")
    +
    `</meugabtxt></meugab>`;
    
  }

  substituido[0] = substituido[0] + solucaoChefe;   /**Perguntas + gabarito do chefe*/  
  console.log("solucaoChefe: ",solucaoChefe);



  //Caso seja das videoaulas:          [tempo perg.,         HTML da pergunta + GAB,  vídeos ajuda,  variáveis da pergunta]
  if(tipoQuestao == "video")  { return [parseInt(chaveQ[0]), substituido[0],         chaveQ[1],     substituido[1]  ];}

  //Caso seja das questões em sala:    [HTML da pergunta   +  variáveis da pergunta]
  if(tipoQuestao == "qEmAula"){ return  substituido                                                      ;}

  //Caso seja das listas:              [HTML da pergunta   +  variáveis da pergunta]
  if(tipoQuestao == "lista")  { return  substituido                                          ;}


}





















function substitui(questoes,mail,nTentativa=1){   //consolePlanilha("nTentativaa: "+nTentativa);//Substitui geradores
  //Chamar e-mail e gerar código pela soma dos caracteres
  // var mail = capturarEmail_AE_7_8_25();//"abcdefghijklmnop.qrstuvwxyz@i";
   var numemail = 0; //Número a ser extraído do e-mail
   mail.replace(/@.*/,'').split('').forEach(function(c){numemail += (c.charCodeAt(0))});
  //Lista das variáveis usadas (devolver para cálculo da resposta)
   var variaveis = [];  
  //Todos os (N~N) e (P~P) 
   var chaves = questoes.match(/(\([NP]~).{1,4}🠚.{1,10}?~.*?[^\n](~[NP]\))/g);            //consolePlanilha(chaves != null);
   if(chaves != null){ //Só exxecuta geração se encontrar algum N ou P
  //Separar dados de cada chave então unidos por "~"
   var padrao = [];
   chaves.forEach(function(e){padrao.push(e.split('~'));});          //consolePlanilha(padrao);
  
                    /////////////////GERADOR NUMÉRICO///////////////// 
   for(var i = 0; i < padrao.length; i++){ //Varrer todos os (N~N) e devolver os números gerados
      if(padrao[i][0]=="(N"){//Caso o padrão seja de gerador numérico
  //Extrai os dados numéricos e transforma em números
        //Tentei assim e não deu (14/02/24): var de = floatVtoP(padrao[i][2]),ate = floatVtoP(padrao[i][3]),passo = floatVtoP(padrao[i][4]);
        var de = Number(padrao[i][2].replace(",", ".")),ate = Number(padrao[i][3].replace(",", ".")),passo = Number(padrao[i][4].replace(",", "."));//Retirar dados do padrão
  //Percentual do intervalo entre 'de' e 'ate'
        var percentintervalo = ((numemail*nTentativa*(ate-de))%(Math.PI))/(Math.PI);  //consolePlanilha(de,ate,passo);
  //Maior número de casas decimais entre de casas 'de', 'ate' e 'passo'
        var casas = Math.max((padrao[i][2]+",").split(",")[1].length, (padrao[i][3]+",").split(",")[1].length); 
        
        //consolePlanilha("mmm: "+(padrao[i][2]+",").split(",")[1].length, (padrao[i][3]+",").split(",")[1].length, (padrao[i][4]+",").split(",")[1].length))


  //Define o passo como o menor intervalo entre as casas decimais
        if(passo==0 || passo==""){passo = 10**(-casas);}
  //Gera o número a ser substituído   
        var gerado = (de + passo*((percentintervalo*(ate-de)/passo)|0)).toFixed(casas).replace(".", ","), geradoexport = gerado;  //consolePlanilha("numemail: " + numemail + "\n padrao: " + padrao[i] + "\n de: " + de + "   ate: " + ate + "    passo(calculado): " +passo + "\n casas decimais (resultado e passo): " + casas + "\n percentual no intervalo: " + percentintervalo*100 +  "% \n Valor gerado: " + gerado);
      }
                    /////////////////SORTEADOR DE PALAVRAS/////////////////   
      else{//Caso o padrão seja de gerador de texto
        var numvar = 0;
  //Gera um número gerador 'numvar' a partir do nome da variável
        (padrao[i][1].match(/(?<=🠚).*/gm)[0]).split('').forEach(function(c){numvar += (c.charCodeAt(0))});
  //Escolhe a posição que está a palavra na lista de opções
        var npalavra = Math.round((padrao[i].length-3)*(((numemail+10*(nTentativa-1)+numvar)%(Math.PI))/(Math.PI))+0.5)+1;
  //Devolve a palavra sorteada   
        var gerado = padrao[i][npalavra], geradoexport = "\""+gerado+"\"";
        //consolePlanilha('numvar: ' + numvar + "\nNúmero de opções:" + (padrao[i].length-1) + "\nnpalavra: "+npalavra+"\nPalavra sorteada: " + gerado);
      }
  //Substituir dados gerados 
    variaveis.push(["⦅" + padrao[i][1] + "🠖" + geradoexport + "⦆"]);
    questoes = questoes.replace(chaves[i], gerado);
    
  } }  //consolePlanilha("variaveis: "+variaveis);  //consolePlanilha("questoes: "+questoes);
  
                    /////////////////ADIONA Nº DA QUESTÃO E EMBARALHA ALTERNATIVAS///////////////// 
  //Acumula todas as <p>QUESTÃO<\/p> no array  
  var perguntas = questoes.replaceAll(/\n|\r/ig,' ').match(/<p>.*?<\/p>/g); //Tava dando problema pelas quebras de linha, por isso o replaceAll(\n)  //consolePlanilha("perguntas: "+perguntas);
  //Varre pelas perguntas  
  for(var i = 0;i<perguntas.length;i++){
  //Substituição dos números das perguntas: perguntas[i] = perguntas[i].replaceAll("££",("00" +(i+1)).slice(-2));
  //Coleta as alternativas  de cada questão i  
     var alternativas = perguntas[i].match(/(?<=\(A~).*?[^\n](?=~A\))/g);    //consolePlanilha("alternativas: " + i + "  " +alternativas);
  //Só executa o código de embaralhamento se encontrar (A~~A) na questão   
     if(alternativas != null){
  //Array para guardar a alternativas e código
        var dict = []; 
  //Varre pelas alternativas dentro da pergunta 'i'   
        for(var j = 0; j < alternativas.length; j++) { //Varre as alternativas para gerar o código base para o ordenamento em dictionary
  //Gera código da alternativa com base no id   
            var numopcao = 0;  
            //var aaaa = alternativas[j].match(/(?<=🠚).*(?= )/gm);//consolePlanilha(alternativas[j]+aaaa);
            (alternativas[j].match(/(?<=🠚).*?(?=['"])/gm))[0].split('').forEach(function(c){numopcao += (c.charCodeAt(0))});
  //Adiciona ao dict a alternativa e o respectivo código gerado com base no id      
            dict.push({    alternativa: alternativas[j],    code: ((numemail*(Math.PI**(nTentativa-1))*numopcao)%(Math.LN2))/Math.LN2});     
          }
  //Ordena no dict as alternativas com base no código       
        dict.sort(function (a, b) {if (a.code > b.code) {return 1;}; if (a.code < b.code) {return -1;};return 0;});
        //consolePlanilha(dict);
  //Substitui as alternativas "(A~~A)" novamente extraídas de cada pergunta 'i' pela nova alternativa ocupando a posição da anterior e adiciona   índice "⟨a⟩"
        for(var j = 0; j < alternativas.length; j++) { perguntas[i] = perguntas[i].replace("(A~" + alternativas[j] + "~A)", "(" + String.fromCharCode((j<26)?97+j:919+j) + ") " + dict[j].alternativa); }
        }; 
    };  
  //Joga novas perguntas no documento 
  //document.write(perguntas.join("\n"));
  //Retorna questões personalizadas e variáveis e valores para usar nos cálculos
  textoHTML = perguntas.join("\n");
  //  consolePlanilha("textoHTML: " + textoHTML);
  return [textoHTML,variaveis];
  }







/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  CORREÇÃO DE QUESTÕES GERADAS  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/



//////////////////////////Corrige as questões (por enquanto só das videoaulas)/////////////////////////////
function corrigirQuestao(textoPerg,resposta,variaveis,nQuestaoBanco){ //consolePlanilha(resposta);
  //Ex.: resposta = "⦅VD🠚id{b}🠖\"false\"⦆"
  //Buscar(variaveis);  
  //Receber(turma,mail,nPergunta,nColVD,resposta);  
    //////////Configura diferente se a solicitação é de lista ou vídeo///////////
  /*  tipoQuestao = "video";
  switch (tipoQuestao) { 
    case "lista":             var ident2 = "££";        break;
    case "video":             var ident2 = "VD";        break;
    case "qEmAula":           var ident2 = "QEA";         break;
    default:           break;
    }
    
    

          
    
    
    */

  //////////////////////////////////////RETIRA CHAVES (F~~F) DO TEXTO DAS PERGUNTAS////////////////////////////////////////
  /////Captura CHAVES (F~~F) da questão "nPergunta" na célula da planilha das QUESTÕES DO VÍDEO
  var chavesF = textoPerg.match(/(\(F~.*?[^\n]~F\))/g);
  var nInputs = chavesF.length;
  /////Abre as chaves (F~~F) em arrays
  var arrayF = [];  for(var i = 0; i < nInputs; i++){    arrayF.push(chavesF[i].split('~'));};//consolePlanilha(arrayF);
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


  ///////////////////////////////////////SUBSTITUIÇÃO DOS VALORES DAS VARIÁVEIS///////////////////////////////////////////
  /////Monta array com variáveis e seus valores para serem substituídos um pelo outro posteriormente
  // if (arrayF[1][3]=="NUM"|arrayF[1][3]=="REG"|arrayF[1][3]=="LS"|arrayF[1][3]=="VF") {
  var variav = [], varSepardas = variaveis.match(/⦅.*?🠚(.*?)🠖(.*?)⦆/g);
  if(varSepardas!=null){
    varSepardas.forEach(function(c){variav.push([c.replace(/⦅.*?🠚(.*?)🠖(.*?)⦆/,"$1"),(c.replace(/⦅.*?🠚(.*?)🠖(.*?)⦆/,"$2")).replace(",",".")])   });  //consolePlanilha(variav);      //[ [ 'n1', '4,50' ], [ 'n2', '9,417' ] ]
    ////Substitui a variável por seu valor
    for(var j = 0; j < varSepardas.length; j++){
      for(var i = 0; i < nInputs; i++){arrayF[i][8] = arrayF[i][8].replaceAll(variav[j][0],variav[j][1]) }
      for(var i = 0; i < nInputs; i++){resposta     =     resposta.replaceAll(variav[j][0],variav[j][1]) }
  }  }
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  // consolePlanilha("resposta em corrigirQues...: "+resposta)
  /////////////////////////////////////DECLARA RESPOSTAS DO ALUNO COMO VARIÁVEIS////////////////////////////////////////////
  /////Monta texto para eval declarar "respostas" como variáveis
  if(resposta != ""){//consolePlanilha("Foi");
    //Troca "," por "." pelo formato numérico; Encontra a variável e o valor; Retira a primeira vírgula (senão: var ,a = 1,)  
    var declResp;

    consolePlanilha("Só tá pegando tipo de resposta do primeiro ítem da questão.");
    switch (arrayF[0][3]) {  
      case "NUM": 
      case "REG": 
      // case "LS": 
      //   declResp = resposta.replaceAll(',','.').replace(/⦅££🠚id\{(.*?)\}🠖(.*?)⦆/g,",resp_$1=$2").replace(',','');break;
      case "LS": 
        declResp = resposta.replaceAll(',','.').replace(new RegExp('⦅.*?🠚id\{(.*?)\}🠖(.*?)⦆','g'), ",resp_$1=$2").replace(',',''); 
      break;
      // case "VF": declResp = resposta.replace(/⦅££🠚id\{(.*?)\}🠖"(.*?)"⦆/g,",resp_$1=$2").replace(',',''); break;
      case "VF": 
        declResp = resposta.replace(new RegExp('⦅.*?🠚id\{(.*?)\}🠖"(.*?)"⦆','g'), ",resp_$1=$2").replace(',',''); 
      break;
      // case "E":  declResp = resposta.replace(/⦅££🠚id\{(.*?)\}🠖(.*?)⦆/g,",resp_$1=('$1'==$2)").replace(',',''); break;
      case "E": 
        declResp = resposta.replace(new RegExp('⦅.*?🠚id\{(.*?)\}🠖(.*?)⦆','g'), ",resp_$1=('$1'==$2)").replace(',',''); 
      break;
      // case "OU": declResp = resposta.replace(/⦅££🠚id\{(.*?)\}🠖(.*?)⦆/g,",resp_$1=$2").replace(',',''); break;
      case "OU": 
        declResp = resposta.replace(new RegExp('⦅.*?🠚id\{(.*?)\}🠖(.*?)⦆','g'), ",resp_$1=$2").replace(',',''); 
      break;
    };  //consolePlanilha("declResp: "+declResp + ";"); 
   
    eval("var "+ declResp + ";");
  }
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 





  ///////////////////////////////////////////////FUNÇÕES DE PLANILHA EM JS////////////////////////////////////////////////
  //Declaração como variáveis das FUNÇÕES DE PLANILHA EM JS chamada pelo js_funções a serem calculado com eval()
  //    js_NOME       = (recebe) =>  texto da função usando o que 'recebe'
  const js_PI         = ()       =>  Math.PI, 
        js_EXP        = (v)      =>  Math.exp(v), 
        js_ABS        = (v)      =>  Math.abs(v), 
        js_SIN        = (v)      =>  Math.sin(v), 
        js_COS        = (v)      =>  Math.cos(v), 
        js_TAN        = (v)      =>  Math.tan(v), 
        js_ASIN       = (v)      =>  Math.asin(v), 
        js_ACOS       = (v)      =>  Math.acos(v), 
        js_ATAN       = (v)      =>  Math.atan(v), 
        js_SEC        = (v)      =>  1 / Math.cos(v), 
        js_CSC        = (v)      =>  1 / Math.sin(v), 
        js_COT        = (v)      =>  1 / Math.tan(v), 
        js_SQRT       = (v)      =>  Math.sqrt(v), 
        js_LN         = (v)      =>  Math.log(v), 
        js_LOG10      = (v)      =>  Math.log10(v), 
        js_VALUE      = (v)      =>  parseFloat(v),      
        js_LOG        = (v,b)    =>  Math.log(v) / Math.log(b),
        js_ROUND      = (v,c=0)  => {const m = Math.pow(10,c);return Math.round(v*m)/m;},  //"c=0" se não declarado  
        js_ROUNDUP    = (v,c=0)  => {const m = Math.pow(10,c);return Math.ceil(v*m)/m;}, 
        js_ROUNDDOWN  = (v,c=0)  => {const m = Math.pow(10,c);return Math.floor(v*m)/m;};
    //  const js_COT = (v1)       => { return 1 / Math.tan(v1);};        //Declarar função de forma alternativa
    // const js_VALUE = (v1)     => {if (isNaN(parseFloat(v1))) {consolePlanilha(`Erro: Não foi possível converter  para um número.`);}return parseFloat(v1);};      //Value
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    





  var feedback = [0,0,[]];      //[Pontuação conseguida,total,Acertos]



  /////Varre por todos os (F~~F)
  for(var h=0;h<arrayF.length;h++){

    ///////////////////Chama função que transforma a função de planilha em função JS/////////////////////
    funcJaEmJS = funcaoSheetToJS(arrayF[h][8]);   //consolePlanilha("funcJaEmJS: "+funcJaEmJS);        //EM FOCO

    //Adiciona como variáveis as referências à "g{Q}"
    var  gab = "";
    if (arrayF[h][3] == "NUM") { 
      funcJaEmJS = funcJaEmJS.replaceAll(/g\{(.*?)\}/g,"gab_$1");
      var gab = funcJaEmJS.replaceAll(/^.*?ABS\(r\{(.*?)\}\/(.*?)-1\)<.*?$/g,"var gab_$1 = $2;");}// consolePlanilha("gab: "+gab); 
    
    //Quando é "E" o gabarito está certo se o id==resposta gabarito, se nas reposta a igualdade tbm for verdadeira...
    if (arrayF[h][3] == "E") { funcJaEmJS = funcJaEmJS.replace(/.*?\{(.*?)\}.*?(".*?").*?/g,'resp_$1 == ("$1" == $2);'); }  
    funcJaEmJS = funcJaEmJS.replace(/r\{(.*?)\}/g,"resp_$1");

    //Funções de planilha já em JS  e  "g{Q}" se for "NUM"
    var   verific =  [funcJaEmJS,gab];            //consolePlanilha("verific: "+verific); 




    //Veririca se as variáveis estão em branco ou deu erro no formato.
    var erroMensagem = "";
    try {var correcao = eval(verific[0]);eval(verific[1])} 
    catch (error) {
      var correcao = null; 
      if(error.message.includes("is not defined")){erroMensagem = "☐";}else{
      var erroMensagem = " Erro na correção, fale com o professor.";  consolePlanilha(error);}
    }
    
    
 
                           
    ////Pontuação: calcula a pontuação adicionando o valor adquirido ao anterior se não for "OU", aí serve qualquer um.
    if(arrayF[h][3]=="OU"){feedback[1]=floatVtoP(arrayF[h][2]);}else{feedback[1] += floatVtoP(arrayF[h][2]);}//Total questão
    let seVisivel = ((arrayF[h][7]=="HIDE")?"🔒":"👁"), 
        seOpcional = ((nQuestaoBanco || "").includes("*"))?0.1:1,
        pesoQuesito = floatVtoP(arrayF[h][2])*seOpcional;

    switch (correcao) {                                                                                       //De acertos
      case true: 
        feedback[2].push([arrayF[h][1],"✅",pesoQuesito,seVisivel]); //["id","✅" ou "❌",peso,"👁" ou "🔒"]
        feedback[0] += pesoQuesito;
      break;
      case false: 
        pesoQuesito = pesoQuesito*floatVtoP(arrayF[h][6].replace(/%/g, '/100'))/100; //calcula a negativação
        feedback[2].push([arrayF[h][1],"❌",pesoQuesito,seVisivel]);
        feedback[0] += pesoQuesito; //consolePlanilha("Diminui")
      break;
      case null: 
        ////Relatório de acertos
        feedback[2].push([arrayF[h][1],erroMensagem,pesoQuesito,seVisivel]);
        // consolePlanilha("Nem soma nem diminui")
      break;
    }
  
  }






  // var a = [arrayF, resposta, variaveis, feedback[2]];        // consolePlanilha(feedback);      //    consolePlanilha(a);

  //Arredonda peso total (eu acho)
  feedback[1] = round_X_N(feedback[1],3)


  //ADICIONAR MARCAÇÃO DE TAREFA CONCLUÍDA NA PLANILHA
  return feedback;      //[Pontuação,PontuaçãoTotal,["[Quesito1","✅",peso,"👁" ou "🔒"],["Quesito2","❌",peso,"👁" ou "🔒"],["Quesito3","☐",peso,"👁" ou "🔒"]]


  /*
  Respostas:
    E: ⦅££🠚id{rosa}🠖"☐"⦆,⦅££🠚id{vermelho}🠖"☐"⦆,⦅££🠚id{azul}🠖"☐"⦆,⦅££🠚id{amarelo}🠖"amarelo"⦆,⦅££🠚id{lilás}🠖"☐"⦆
    NUM,LS,REG: ⦅a🠖1⦆,⦅b🠖2⦆,⦅c1🠖2⦆,⦅c2🠖2⦆,⦅d🠖"2/3"⦆,⦅e1🠖"negativo"⦆,⦅e2🠖"n1 > n2"⦆,⦅f🠖2⦆
    VF: ⦅££🠚id{b}🠖"true"⦆,⦅££🠚id{d}🠖"false"⦆,⦅££🠚id{a}🠖"true"⦆,⦅££🠚id{c}🠖"false"⦆,⦅££🠚id{e}🠖"true"⦆
    OU: ⦅££🠚id{1500}🠖"1500"⦆
    Nada: ""eval

  Formulários:
    [  0  , 1  ,  2   ,   3  ,        4     , 5 ,  6   ,   7   ,                8                  ,   9  ], 
    [ '(F', 'a', '0,1', 'NUM', 'Número real', '', '-0%', 'SHOW', 'ABS(r{a}/(     n1+n2     )-1)<2%', 'F)' ],   */
    
}













function funcaoSheetToJS(eqSheet   /*,indice*/){ //Esse índice é provisório //consolePlanilha("função "+indice +": "+ eqSheet);

  //Transforma em texto a equação e substitui "," por "." || ";" por "," ||"=" por "==" ||"&" por "+" || "<>" por "!="
  var eqSheetSemParen = String(eqSheet).replaceAll(/(\d),(\d)|(\w*)%|;|TRUE|FALSE|=|\^|&|<>/g, (match, p1, p2, p3) => {
    if (p1 !== undefined && p2 !== undefined) {
        return `${p1}.${p2}`;
    } else if (match === ';') {
        return ',';
    } else if (match === 'TRUE') {
        return 'true';
    } else if (match === 'FALSE') {
        return 'false';
    } else if (match === '=') {
        return '==';
    } else if (match == '&') {
        return '+'; 
    } else if (match === '<>') {
        return '!='; 
    } else if (match === '^') {
        return '**'; 
    } else if (p3 !== undefined) {
        return `(${p3}/100)`;
    }
  });           
  /*  //Versão antiga menos eficiente (reabilitar se a função de cima se der problema)
  //Transforma em texto a equação e substitui "," por "." || ";" por "," ||"=" por "==" ||"&" por "+" || "<>" por "!="
  var eqSheetSemParen = String(eqSheet).replaceAll(/(\d),(\d)/g,"$1.$2").replaceAll(/;/g,",").replaceAll(/=/g, '==').replaceAll(/&/g, '+').replaceAll(/<>/g, '!=').replaceAll(/\^/g, '**').replaceAll(/(\w*)%/g, '($1/100)').replaceAll("TRUE","true").replaceAll("FALSE","false");//consolePlanilha(eqSheetSemParen);
  */


  //Substitui parêntesis entre "" por "⦏⦑" ou "⦒⦐", isso para não serem reconhecidos como função
  var aspas = eqSheetSemParen.match(/"[^"]*?"/g);
  if(aspas != null){                        //consolePlanilha(aspas);
   aspas.forEach(function(item,index){if(item.match(/\(|\)/g)!=null){eqSheetSemParen = eqSheetSemParen.replaceAll(item,(item.replaceAll("(","⦏⦑")).replaceAll(")","⦒⦐"))}}); 
  }

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////Desmontar equação em funções////////////////////////////////////////////////
  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //Número de parêntesis encontrados é o número de ciclos de extração de funções, e array de funções extraídas que serão transformadas em JS
  var numParentesis = ((eqSheetSemParen.match(/[A-Za-z]*\(/g)||0).length || 0), arrayFuncaoSimples = [];  
  //consolePlanilha("numParentesis: "+numParentesis);                   //aaaaa = aaaaa +indice+" "+numParentesis+" ";  
  // Extração de funções e substituição por "ᶠᵘⁿNᶜᵃᵒ"
  for(var t = 0; t < numParentesis ; t++){                          //consolePlanilha("Eq."+(indice+1)+": "+eqSheetSemParen);

    var funcaoSimples = eqSheetSemParen.match(/[A-Za-z]*\([^()]*\)/g)[0];  // consolePlanilha("funcaoSimples: "+funcaoSimples);


    eqSheetSemParen = eqSheetSemParen.replace(funcaoSimples,"ᶠᵘⁿ"+t+"ᶜᵃᵒ");  //consolePlanilha(eqSheetSemParen);


    // funcaoSimples = funcaoSimples.toUpperCase();
    var nomeFuncao = (funcaoSimples.match(/^(.*?)\(/)[1]).toUpperCase();    //consolePlanilha("nomeFuncao: "+nomeFuncao);

    //Configurar para demais funções
    switch (nomeFuncao) { 
      case  "OR":                  
        funcaoSimples=(funcaoSimples.replace(/^(OR|or)\(/g,"((")).replaceAll(",",")||(")+")";
      break; 
      case  "AND":                  
        funcaoSimples=(funcaoSimples.replace(/^(AND|and)\(/g,"((")).replaceAll(",",")&&(")+")";
      break; 
      case  "IF":       
        funcaoSimples = funcaoSimples.replace(/(IF|if)\((.*?),(.*?),(.*?)\)/g,"(($2)?($3):($4))");
        funcaoSimples = funcaoSimples.replace(/(IF|if)\((.*?),(.*?)\)/g,"(($2)?($3):(false))");
      break; 
      case  "TEXT":                  
        consolePlanilha("Não tem nada feito para a função TEXT()");
      break; 
      case  "IFS":            
        funcaoSimples = '(' + funcaoSimples.replaceAll(/(^(IFS|ifs)\(|)(.*?),(.*?)(,|\))/g,"($3)?($4):" ) + '"")';
      break; 
      case  "":                  
      //Manter essa oção vazia
      break; 
      default:                        
        funcaoSimples = "js_" + funcaoSimples;     //consolePlanilha(eqSheetSemParen) 
      break;        };

    

    //Recoloca os parêntesis entre aspas
    if(aspas != null){  funcaoSimples = (funcaoSimples.replaceAll("⦏⦑","(")).replaceAll("⦒⦐",")"); };

    //Cria um array com cada função retirada e o espaço para substituí-la de volta: "ᶠᵘⁿ1ᶜᵃᵒ"
    arrayFuncaoSimples.push(funcaoSimples);                                     
  }
  //Coloca por no array último a função completa com os "ᶠᵘⁿ1ᶜᵃᵒ"
    arrayFuncaoSimples.push(eqSheetSemParen);
 

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////Remontar funções de volta na equação com _js//////////////////////////////////
  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  //Último termo do array de funções que será substituido pelos termos anteriores
  var ultimo = arrayFuncaoSimples.length-1;
  var equacaoFinal = arrayFuncaoSimples[ultimo];

  for(var i = ultimo; i >= 0; i--){equacaoFinal = equacaoFinal.replaceAll("ᶠᵘⁿ"+i+"ᶜᵃᵒ",arrayFuncaoSimples[i]); }

  //consolePlanilha([indice + 26 , eqSheet, equacaoFinal , arrayFuncaoSimples])       //  [provisório, equação original pra vizualizar, equação de saída, passos da substituição pra visualizar]  

    return   equacaoFinal;             //EM FOCO
}














/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  Experimental  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/

/////////////////////////////Salva dado enviado do experimento/////////////////////////////////////////
function gravarExp(nExp,link,linha_aluno){try{//consolePlanilha(nExp,turma,link);

  var agora = _ => new Date().toLocaleString('pt-BR',{ hour12: false });
 
  consolePlanilha(PLANILHA.getSheetByName(PAGINA).getRange(linha_aluno+9,30+nExp).getValue());
  PLANILHA.getSheetByName(PAGINA).getRange(linha_aluno+9,30+nExp).setFormula(`=HYPERLINK("${link}";"${agora()}~${link}")`);


  return "Sua resposta foi salva com sucesso!";

  }catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}
  


























/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  Lista  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/


function puxarLista(nlista,nVinculo,mail){try{        
  
  ////////////////////Captura e-mails para filtro. Devolve linha(s) do aluno, turma e linha do cabeçalho////////////////////
  let avalAlunos = PLANILHA.getSheetByName(PAGINA).getRange("B9:D").getValues(),
      linhas_aluno = [];            //Guardará descrito acima: [[9,['Pa',9]],[69,['MQ1',69]]]
  ////////////////////Filtro que devolve linha(s) do aluno,turma e linha do cabeçalho(todos os vínculos)////////////////////
  avalAlunos.filter(function(linha, idx) {if (linha[2] === mail) { linhas_aluno.push([idx,JSON.parse(linha[0])]); }   });       
  ////////////////////Seleciona por padrão o primeiro vínculo: "0"////////////////////
  nVinculo = nVinculo || 0;  

  ////////////////////Declara todas variáveis////////////////////
  let linhaDoEmail = linhas_aluno[nVinculo][0]+9,  //Linha do aluno na planilha com base no vínculo selecionado.Ex.:18
      linhaGeral = linhas_aluno[nVinculo][1][1]+8,  //Linha do cabeçalho na planilha com base no vínculo selecionado.Ex.:17
      coluna = (184+2*(nlista-1)),  //Coluna da lista selecionada.Ex.:184
      dadosGerais = (PLANILHA.getSheetByName(PAGINA).getRange(linhaGeral,coluna).getValue()).split("⧛"),//Parâmetros gerais.Ex.:TRUE,Grandezas físicas,g = 10 m/s²,182|3*|4|5*|6,0.500,2050-01-06T23:59:59,(Q~F2~Lei dos gas...
      visivel = (dadosGerais[0]).toLowerCase() === "true",  //Verifica se a lista está visível antes de abrir
      titulo = "<h2 style='text-align:center;'>" + dadosGerais[1] + "</h2>\n<br>",//Ex.:<h2 style='text-align:center;'>Grandezas físicas</h2><br>
      dadosFisicos = dadosGerais[2],   //Parâmetros para ajudar alunos.Ex.:g = 10 m/s²
      nQuestaoBanco = dadosGerais[3].split("|"),    //Numeros das questões no banco de questões: ['2','3*','4',...]
      tempoFB = parseFloat(dadosGerais[4]),  //Tempo de espera para novo feedback 
      prazoLista = new Date(dadosGerais[5]),  //Data e hora que fecha o envio da lista
      questoes = dadosGerais.slice(6),  //Todo o resto do vetor são os textos das questões tirados do Banco
      dadosIndividuais = (PLANILHA.getSheetByName(PAGINA).getRange(linhaDoEmail,coluna).getValue()).split("䷁"),
      respostasSalvas = dadosIndividuais[5] || "ausente",   //Verifica se já foi enviada alguma resposta para carrregá-las
      ultimoFeedback = dadosIndividuais[6] || "", //Data do último feedback
      geradorFormulario = [],   //Acumulará "por questão" os geradores "(F~...~F)" com o número da questão
      //formularios,   //Acumulará "para toa a lista" os geradores "(F~...~F)" com o número da questão
      questoesProntas = "",   //Guardará as questões já no formato HTML final
      variaveis = [];    //Guardará as variáveis para visualização da solução pelo Chefe
      // console.log(linhas_aluno,coluna,dadosIndividuais,dadosGerais);  //      console.log(nQuestaoBanco);


          //////////////////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////GERA A PERSONALIZAÇÃO DAS QUESTÕES ()em prepararQuestao/////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////
  if(visivel){
    ////////////////////Varre o array de questões////////////////////
    questoes.map((perguntaX,index) => {
      //////////CALCULA O PESO TOTAL DAS QUESTÕES DADO DOS FORMULÁRIOS////////////
      var regex = /\(F~.*?~(.*?)~/g, somaPesos = 0, match;
      ////////////////////Soma os pesos dos "(F~...~F)" em "somaPesos" por questão////////////////////
      while ((match = regex.exec(perguntaX)) !== null) {somaPesos += floatVtoP(match[1])};//consolePlanilha(somaPesos)
      //////////Número formatado como: "01"////////////
      let nQuestao = ("0" + (index+1)).slice(-2);   //01, ...
      //////////Coloca o "01" em cada formulário para identificá-lo para a questão////////////
      geradorFormulario.push((perguntaX.replaceAll(/\(F~/g,"(F~"+nQuestao+"~")).match(/\(F~.*?~F\)/gm));
                // console.log(perguntaX.replaceAll(/\n/g, "<br> "),somaPesos,"lista",mail,null,nQuestao);







      //////////Chama a função que formata a questão para exibição na lista////////////
      let questaoEvariaveis = prepararQuestao(perguntaX.replaceAll(/\n/g, "<br> "),somaPesos,"lista",mail,null,nQuestao,nQuestaoBanco[index]);






      //////////Acumula as questões já formatadas, 1º elemento retornado////////////
      questoesProntas += questaoEvariaveis[0];//.replaceAll("££",("0" + (index+1)).slice(-2));
      //////////Acumula as variáveis para o professor olhar o gabarito, 2º elemento retornado////////////
      variaveis.push(questaoEvariaveis[1]);      //return questaoPronta;
    });
    //////////Deixa os arrays de três dimensões em apenas duas: [[[],[]],[[]]] => [[],[],[]]////////////
    variaveis = variaveis.flat();
              //  consolePlanilha(questoesProntas);// return 1;
    //////////Deixa os arrays multidimensionais em apenas uma: [[[],[]],[[[],[]]]] => [ , , , ]////////////
    //formularios = geradorFormulario.flat(Infinity).join("\n");//console.log(formularios)
  }                           //else{ questoesProntas = ["",]; }        
     


  // [Título + HTML gerado,variáveis,[data último fb,intervalo p/ solicitar],[data validade lista],respostas,dados]
  let saida = [ titulo + questoesProntas,
                variaveis,
                [ultimoFeedback,tempoFB],
                [prazoLista.toString(),prazoLista.hmsDMA()],
                respostasSalvas,
                dadosFisicos];
      //  consolePlanilha(saida);  consolePlanilha(prazoLista.hmsDMA());
  return saida;         //HTML das Perguntas,Variáveis,Feedback,Validade,Gabarito 


}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}      













/////////////////////////////Grava as respostas da lista/////////////////////////////////////////
function gravarRespLista(turma,respostas,variaveis,nlista,htmlPergResp,fb,mail,nVinculo){try{ 
  //  consolePlanilha(turma,respostas,variaveis,nlista,htmlPergResp,fb,email,nVinculo);
 
  ////////////////////Captura e-mails para filtro. Devolve linha(s) do aluno, turma e linha do cabeçalho////////////////////
  let avalAlunos = PLANILHA.getSheetByName(PAGINA).getRange("B9:D").getValues(); 
  ////////////////////Guardará descrito acima: [[9,['Pa',9]],[69,['MQ1',69]]]////////////////////
  var linhas_aluno = [];
  ////////////////////Filtro que devolve linha(s) do aluno,turma e linha do cabeçalho(todos os vínculos)////////////////////
  avalAlunos.filter(function(linha, idx) {if (linha[2] === mail) { linhas_aluno.push([idx,JSON.parse(linha[0])]); }   });       
  ////////////////////Seleciona por padrão o primeiro vínculo: "0"////////////////////
  nVinculo = nVinculo || 0;  

  ////////////////////Declara todas variáveis////////////////////
  let linhaDoEmail = linhas_aluno[nVinculo][0]+9,  //Linha do aluno na planilha com base no vínculo selecionado.Ex.:18
      linhaGeral = linhas_aluno[nVinculo][1][1]+8,  //Linha do cabeçalho na planilha com base no vínculo selecionado.Ex.:17
      coluna = (184+2*(nlista-1)),  //Coluna da lista selecionada.Ex.:184
      dadosGerais = (PLANILHA.getSheetByName(PAGINA).getRange(linhaGeral,coluna).getValue()).split("⧛"),//Parâmetros gerais.Ex.:TRUE,Grandezas físicas,g = 10 m/s²,182|3*|4|5*|6,0.500,2050-01-06T23:59:59,(Q~F2~Lei dos gas...
      htmlParaFB = htmlPergResp.replace(/<meugab[\s\S]*?<\/meugab>/g, "").replaceAll(/<button.*?\/button>/g,"").replaceAll(/<sup class="peso".*?\/sup>/g,""),//Ex.:<p id="perguntasaqui" style="p...
      nQuestaoBanco = dadosGerais[3].split("|"),    //Numeros das questões no banco de questões: ['2','3*','4',...]
      visivel = (dadosGerais[0]).toLowerCase() === "true",  //Verifica se a lista está visível antes de abrir: true
      prazoLista = new Date(dadosGerais[5]),//Data que fecha o envio da lista: "Thu Jan 06 23:59:59 GMT-03:00 2050"
      variaveisArray = ((typeof variaveis === "string")?JSON.parse(variaveis.replace(/"/g, '\\"').replace(/'/g, '"')):variaveis).flat(Infinity),
      dadosIndividuais = (PLANILHA.getSheetByName(PAGINA).getRange(linhaDoEmail,coluna).getValue()).split("䷁"),
                              /*NOTA䷁pontuação OBTIDA de TOTAL䷁Data de envio䷁
                              Relatório de acertos vindo do GS䷁
                              Variaveis䷁
                              Respostas䷁
                              Data último feedback*/
      chefe = EMAILCHEFE.includes(E_MAIL_DETECTADO),
      dataUltimoFB = dadosIndividuais[6] || "Wed Jan 01 2000 20:47:36 GMT-0300 (Horário Padrão de Brasília)",
      tempoFB = parseFloat(dadosGerais[4])*3600000, //Espera para novo feedback em ms p/ funcionar com hora quebrada: 0.5 h 
      ultimoFB_MaisPrazo = new Date(new Date(dataUltimoFB).getTime() + tempoFB),//A partir dessa data devolve FB
      dataEnviadaFB = (chefe || !fb)?dataUltimoFB:(new Date()).toString(),
      dataUltimoEnvio = new Date, //Data do último feedback
      perguntas = dadosGerais.slice(6),
      perguntasAvaliadas = [],
      pontuacaoObtida = 0,
      pontuacaoTotal = 0,
      relatorioAcertos = "";
      //geradorFormulario = [],   //Acumulará "por questão" os geradores "(F~...~F)" com o número da questão
      //formularios,   //Acumulará "para toa a lista" os geradores "(F~...~F)" com o número da questão
      //questoesProntas = "",   //Guardará as questões já no formato HTML final
      //questoes = dadosGerais.slice(6),  //Todo o resto do vetor são os textos das questões tirados do Banco
      //respostasSalvas = dadosIndividuais[5] || "ausente",   //Verifica se já foi enviada alguma resposta para carrregá-las
      // titulo = "<h2 style='text-align:center;'>" + dadosGerais[1] + "</h2>\n<br>",//Ex.:<h2...>Grandezas físicas...>
      // dadosFisicos = dadosGerais[2],   //Parâmetros para ajudar alunos.Ex.:g = 10 m/s²


///////////////////////////////////  SE NÃO ESTIVER NO PRAZO NÃO GRAVA A LISTA  /////////////////////////////////////
if(!visivel && (prazoLista > new Date())) return ["Fora do período de envio.","Converse com o professor se isso for um erro."];

 
      //variaveis = [];    //Guardará as variáveis para visualização da solução pelo Chefe
      // console.log(linhas_aluno,coluna,dadosIndividuais,dadosGerais);  //console.log(nQuestaoBanco);


  //console.log(variaveis);

  // Variaveis: '⦅VD🠚a1🠖"pizza"⦆⦅VD🠚a2🠖"cilíndrica"⦆⦅VD🠚b1🠖"galo"⦆⦅VD🠚b2🠖"não"⦆⦅VD🠚b3🠖"4"⦆⦅VD🠚c1🠖"3"⦆'

  // respostas = [ '⦅01🠚id{a}🠖13,918⦆', '⦅01🠚id{b}🠖44⦆', '⦅01🠚id{c1}🠖43⦆', '⦅01🠚id{c2}🠖52⦆', '⦅01🠚id{d}🠖"43/3"⦆', '⦅01🠚id{e1}🠖"positivo"⦆', '⦅01🠚id{e2}🠖"n2 > n1"⦆', '⦅01🠚id{f}🠖5252⦆', '⦅02🠚id{1500}🠖"1500"⦆', '⦅03🠚id{rosa}🠖"☐"⦆', '⦅03🠚id{vermelho}🠖"☐"⦆', '⦅03🠚id{azul}🠖"azul"⦆', '⦅03🠚id{amarelo}🠖"☐"⦆', '⦅03🠚id{lilás}🠖"lilás"⦆', '⦅04🠚id{b}🠖"false"⦆', '⦅04🠚id{d}🠖"true"⦆', '⦅04🠚id{a}🠖"false"⦆', '⦅04🠚id{c}🠖"false"⦆', '⦅04🠚id{e}🠖"false"⦆' ]

  //Cria array novo com elementos que começam com um texto n
    const filtrar_N = (array,texto) => array.filter(item => item.startsWith(texto));   

  perguntas.map((pergunta,n) => {
    //let resposta = (respostas.filter(item => item.startsWith('⦅'+("0" + (n+1)).slice(-2)))).join('')
    let num = ("0" + (n+1)).slice(-2),
        resposta = filtrar_N(respostas,'⦅'+ num).join(''),
        variavel = filtrar_N(variaveisArray,'⦅'+num).join('');











    ///////////////////////////////////ENVIA CADA QUESTÃO E RESPOSTAS PARA CORREÇÃO/////////////////////////////////////////
    //Retorna: [Pontuação,PontuaçãoTotal,["[Quesito1","✅",0.3],["Quesito2","❌",-0.2],["Quesito3","☐",0]]
    perguntasAvaliadas[n] = corrigirQuestao(pergunta,resposta,variavel,nQuestaoBanco[n]);
    











    pontuacaoObtida += (perguntasAvaliadas[n][0] > 0)?perguntasAvaliadas[n][0]:0;
    pontuacaoTotal += perguntasAvaliadas[n][1];





    (perguntasAvaliadas[n][2]).forEach( 
      function(c){
        let id = num + "🠚id{"+c[0]+"}";
    ////////////////////////  CRIA SINALIZAÇÃO DE ACERTOS NO HTML E ERRO PARA O E-MAIL DE FEEDBACK  /////////////////////
        
        

        

        if((new Date() > ultimoFB_MaisPrazo) || chefe){//Sinaliza tendo dado o tempo da última solicitação ou sendo chefe
          if(fb && c[3] == "👁"){
            let regID = new RegExp("\(\""+id+"\"\)");
            switch (c[1]) {                 
              case "✅":  htmlParaFB = htmlParaFB.replace(regID,"$1 style=\"background:#DBFFAF\"");   break;
              case "❌":  htmlParaFB = htmlParaFB.replace(regID,"$1 style=\"background:#FFCCCC\"");   break;
              default:                                                                                break;
            }
          }
        }








    ///////////////////////////////////MONTA UMA EXIBIÇÃO DE RELATÓRIO PARA CADA (F~...~F)/////////////////////////////////
        relatorioAcertos += "⦅"+ id +c[1]+((c[2]<0)?c[2]:"+"+c[2])+"⦆";
        }    );               //⦅06🠚id{l}✅+1,00⦆
  })    // consolePlanilha("Aqui 1: ",perguntasAvaliadas);


  // consolePlanilha("Saidas: ",round_X_N(pontuacaoObtida,3), pontuacaoTotal, relatorioAcertos,perguntasAvaliadas)
  let   notaDoTotal = (round_X_N(pontuacaoObtida,3) + " de " + pontuacaoTotal), 
        registroPlanilha =  round_X_N(10*pontuacaoObtida/pontuacaoTotal,3) + "䷁" + 
              notaDoTotal + "䷁" +
              dataUltimoEnvio + "䷁\n" +
              relatorioAcertos + "䷁\n" +
              variaveisArray.join("") + "䷁\n" +
              respostas.join("") + "䷁" +
              dataEnviadaFB;// Se é chefe ou não solicitou FB, mantem a data. Se solicitou FB coloca data atual

  
  
  ///////////////////////////////////////REGISTRA RELATÓRIO DO ALUNO NA PLANILHA/////////////////////////////////////////
  PLANILHA.getSheetByName(PAGINA).getRange(linhaDoEmail,coluna).setValue(registroPlanilha); //consolePlanilha(registroPlanilha);



  //////////////////////////////////////////////////////ENVIO DO E-MAIL////////////////////////////////////////////////////
  htmlParaFB = "<fieldset disabled='disabled'><legend><h3>Nota atual: <b style='color: blue;'>"+ notaDoTotal+ "<b></h3></legend>" + htmlParaFB + "</fieldset>";
  MailApp.sendEmail({to: mail, subject:"Confirmação de submissão de respostas da lista",htmlBody: htmlParaFB});  // consolePlanilha(htmlParaFB);

            
  return ["Enviado com sucesso!","As respostas foram salvas e o relatório enviado ao seu e-mail."];

}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}





























/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  Videoaulas  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/

function dadosVideo(nColVD,linha_aluno,linha_dadosTurma,mail,nTentativa) {try{   /////////////Puxa dados do número do vídeo clicado//////////////////// 
  consolePlanilha(nColVD,linha_aluno,mail,nTentativa,linha_dadosTurma)
  var nColVD = nColVD || 1;
  var gerais=PLANILHA.getSheetByName(PAGINA).getRange(linha_dadosTurma,nColVD,linha_dadosTurma,nColVD+7).getValues();
  var individual = PLANILHA.getSheetByName(PAGINA).getRange(linha_aluno+9,nColVD, 1, 1).getValue();
  var perguntas = [];
  // consolePlanilha(JSON.parse(individual))
  if(gerais[0][7] != ""){
    //////////CALCULA O PESO TOTAL DAS QUESTÕES DADO DOS FORMULÁRIOS////////////
    var regex = /\(F~.*?~(.*?)~/g, somaPesos = 0, match;
    while ((match = regex.exec(gerais[0][7])) !== null) {somaPesos += floatVtoP(match[1])};//consolePlanilha(somaPesos)


    //////////SUBSTITUI AS QUEBRAS /N POR <BR> E SEPARA AS QUESTÕES////////////
    perguntas = (gerais[0][7].replaceAll(/\n|\r/ig,'<br>')).split("ꖶ");  //consolePlanilha(perguntas.length)


    //////////VERIFICA SE O ALUNO RESPONDEU ALGUMA VEZ,SE NÃO, CRIA UMA TABELA EM BRANCO COM t=0s E Nº DE COLUNAS = Nº PERGUNTAS////////////
    var execTarefasViAu  = JSON.parse((individual == "")?'[0' + ',[0,0]'.repeat(perguntas.length)+']':individual);    //Cria array se na primeira execução  
  // consolePlanilha("execTarefasViAu: ",execTarefasViAu)
  // consolePlanilha("perguntas.length: ",perguntas.length)

      //////////PEGA CADA QUESTÃO SEPARADA E ENVIA PARA A FUNÇÃO DE PREPARAR QUESTÕES POR TIPO////////////
    if(nTentativa == undefined){  
      for(var i = 0; i < perguntas.length; i++){
  //Dá erro aqui quando tem menos dados que perguntas no espaço de VIDEOAULAS na planilha: Ex.[5000,[10,2],[0,0](,[falta aqui])]
        perguntas[i] = prepararQuestao(perguntas[i],somaPesos,"video",mail,execTarefasViAu[i+1][1]+1);
      }
    }
    else{    //consolePlanilha("nTentativa é definido: "+nTentativa)
      for(var i = 0; i < perguntas.length; i++){
        perguntas[i] = prepararQuestao(perguntas[i],somaPesos,"video",mail,nTentativa);
      }
    };
    
    //  [[Tseg,n1º%,n2º%,...], [link,          título],        [tempo perg, HTML perguntas],  [link da apresentação]]  
    var dado =  [    execTarefasViAu,      [gerais[0][5],  gerais[0][4]],  perguntas,                      gerais[0][6]];//consolePlanilha("link da apresentação: ",gerais[0][6])
  }else{
    var dado = false;
  }
  
        //consolePlanilha(dado[2][0][3]+"\n¨¨\n"+dado[2][1][3]+"\n¨¨\n"+dado[2][2][3]+"\n¨¨\n"+dado[2][3][3]);
      //  consolePlanilha(dado[2][0][2]);      //dado[2][questão][2]
      //consolePlanilha(perguntas)

  return dado;
}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}











//////////////////////////Chama correção de questões das videoaulas/////////////////////////////
function corrigirPergViAu(nPergunta,nColVD,resposta,variaveis,linha_dadosTurma){try{

  var perguntas  = PLANILHA.getSheetByName(PAGINA).getRange(linha_dadosTurma,nColVD+7).getValue();
  var textoPergN = (perguntas.split("ꖶ"))[nPergunta-1];
  
  return corrigirQuestao(textoPergN,resposta,variaveis)

}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}




function salvandoViAu(linha_aluno,nColVD,tarefas){try{
  // var celula = PLANILHA.getSheetByName(turma).getRange(dadosAlunos_AE_7_8_25(mail)[3],nColVD).getValue()//(link);

  var individual = PLANILHA.getSheetByName(PAGINA).getRange(linha_aluno+9,nColVD, 1, 1);
  
  individual.setValue(tarefas.replaceAll("%",""));  //consolePlanilha("Tarefas: " + linha_aluno,nColVD,tarefas);


   return "Estado viau salvo!";

}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}

























/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  Questão em aula  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/

/////////////////////////////Puxa dados do número do vídeo clicado/////////////////////////////////////////
function puxarQEA(dadosQuestao) {try{
  //var dadosQuestao = dadosAlunos_AE_7_8_25(capturarEmail_AE_7_8_25(),true);        //

  // dadosQuestao = dadosQuestao || [,,,];

  let dado_QEA = PLANILHA.getSheetByName(PAGINA).getRange("FS6:FW8").getValues(); //consolePlanilha(dado_QEA);

              //[turma,email,nome,linha_aluno,[TEXTO QUESTÃO,  1A2⟹AULA,      nQUESTÃO,      PRAZO,         nCARIMBOS]]
  dadosQuestao[4] = [dado_QEA[2][3],dado_QEA[2][0],dado_QEA[0][2],dado_QEA[0][3],dado_QEA[0][4]];  //consolePlanilha(dadosQuestao)

  if(dadosQuestao[4]){  //Verificar
    var pergunta = dadosQuestao[4][0];    consolePlanilha(pergunta.replaceAll(/\n/g, "<br>"))
      
    var mail = Array.from({length: Math.floor(Math.random() * 11) + 5}, () => "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(Math.random() * 62))).join('');	//consolePlanilha("Número gerador de variável: " + number); 
    // var nTentativa = 1;

  //////////CALCULA O PESO TOTAL DAS QUESTÕES DADO DOS FORMULÁRIOS////////////
    var regex = /\(F~.*?~(.*?)~/g, somaPesos = 0, match;
    while ((match = regex.exec(pergunta)) !== null) {somaPesos += floatVtoP(match[1])};//consolePlanilha(somaPesos)

    //Colocando a questão pronta no lugar da questão geradora
    dadosQuestao[4][0] = prepararQuestao(pergunta.replaceAll(/\n/g, "<br>"),somaPesos,"qEmAula",mail+"@").join("𢆯");
    dadosQuestao[4][5] = dadosQuestao[3]     //Adicionando a linha do aluno no primeiro termo vazio
       
    return dadosQuestao[4].join("𢆯");     // [TEXTO QUESTÃO,VARIÁVEIS,1A2⟹AULA,Nº DA QUESTÃO,PRAZO,LINHA DO ALUNO]
  }else{return false}

}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}








//////////////////////////Chama correção de questões das questões em aula/////////////////////////////
function corrigirPergQEA(linha_aluno,resposta,variaveis){try{//consolePlanilha(nRow,resposta,variaveis)
  // linha_aluno = 18; resposta = '⦅QEA🠚id{a}🠖130⦆⦅QEA🠚id{b}🠖32⦆⦅QEA🠚id{c1}🠖3⦆⦅QEA🠚id{e1}🠖"positivo"⦆' , variaveis = '⦅01🠚n1🠖7,50⦆,⦅01🠚n2🠖121,514⦆', 
  carimbado = "📤";  //ARRUMAR (vir do site do professor)

  let dado_QEA = PLANILHA.getSheetByName(PAGINA).getRange("FS6:FW8").getValues();
  // var dados = PLANILHA.getSheetByName("Alunos").getRange("C3:H5").getValues(); //consolePlanilha(dados)
  var liberacao = dado_QEA[0][0],
      aula = dado_QEA[2][0].replace(/⟹.*$/,"⟹"), 
      textoPerg = dado_QEA[2][3],turma = dado_QEA[0][1],
      nQuestao = ("00" +dado_QEA[0][2]).slice(-2),
      prazo = new Date(dado_QEA[0][3].toString()),
      nCarimbos = dado_QEA[0][4].toString().replace('.', ',');

  // consolePlanilha("Aqui: "+liberacao +"\n"+ (typeof prazo )+"\n"+ (typeof new Date())+"\n"+  (new Date(prazo) > new Date()))
  //Verifica se o momento da submissão já superou o prazo o a lista foi desabilitada.
  //new Date((new Date().toString()).replace(/^((.*?\s){4}).*/,"$1") + prazo.replace(/^(.*?\s){4}/,""))  >  new Date()
  // if((new Date((new Date().toString()).slice(0,16)+prazo.slice(16)) > new Date())  && liberacao){
  if((prazo > new Date())  && liberacao){
    var feedback = corrigirQuestao(textoPerg,resposta,variaveis);
    var percentFBQEA = Math.round(100*Math.max(0,feedback[0])/feedback[1]);                 consolePlanilha(percentFBQEA)
    salvandoQEA(turma,linha_aluno,nCarimbos,percentFBQEA,aula,nQuestao,carimbado); 
  }else{  var feedback = false; } //VERIFICAR:  ARRUMAR ISSO AQUI
  

  consolePlanilha(feedback); 
  return feedback;
}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}











function salvandoQEA(turma,linha_aluno,nCarimbos,percentFBQEA,aula,questao,carimbado){        //consolePlanilha(turma,linha_aluno,feedbQEA);
  var atual = PLANILHA.getSheetByName(PAGINA).getRange(linha_aluno+9,175).getFormula().split('\n'); 
  if(atual==""){atual = ['="{Sobra:"&ROUND(',';2)-(0',')&"🔐}"'];}
  consolePlanilha(atual.join("\n"))

  //Encontrar a posição da questão caso já tenha sido submetida
  var nElemento = false,nElementos = ((atual.length-3)/3);
  for (var i = atual.length-1; i > 1; i--){  if(atual[i].includes(aula + questao)){nElemento = i-3-2*nElementos+1; }}; 
  consolePlanilha("nElemento: "+nElemento);
  
  if(nElemento){ consolePlanilha("atual[nElemento]: "+atual[nElemento]);//Substituir a linha da atividade caso já tenha sido feita
    var nTentativaQEA = parseInt(atual[nElemento].match(/\^(.*?)$/i)[1]) +1;    //Adiciona 1 à quantidade de tentativas"
    var valor = "(" + nCarimbos + "*" + percentFBQEA + "%)*(80%)^" + nTentativaQEA;

    atual[nElemento] = "+    " + valor;
    atual[nElementos+1+nElemento] = "+ROUNDDOWN((       " + valor + "       )*2)/2";
    atual[2*nElementos+2+nElemento] ='&"{' + aula + questao + ':"&(ROUNDDOWN((       ' + valor + '       )*2)/2)&"'+ carimbado + '}"';
  }
  else{//Adicionar nova linha na última posição
    var valor = "(" + nCarimbos + "*" + percentFBQEA + "%)*(80%)^0";

    // atual[1*nElementos+0] += "\n"+ "+    " + valor;
    atual.splice(1*nElementos+1, 0, "+    " + valor);
    // atual[2*nElementos+1] += "\n"+ "+ROUNDDOWN((       " + valor + "       )*2)/2";
    atual.splice(2*nElementos+3, 0, "+ROUNDDOWN((       " + valor + "       )*2)/2");
    atual[3*nElementos+4] += "\n"+ '&"{' + aula + questao + ':"&(ROUNDDOWN((       ' + valor + '       )*2)/2)&"'+ carimbado + '}"';
  }


  consolePlanilha("Saída: "+atual.join("\n"));
  PLANILHA.getSheetByName(PAGINA).getRange(linha_aluno+9,175).setValue(atual.join("\n"));
  
  return "Respostas salvas!";


}











































/*<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
         >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  FUNÇÕES OBSOLETAS  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->*/






//const mailCapturado =  /*RECEBER E-MAIL AQUI */"ezequiel.melo@ifsc.edu.br"; //Session.getActiveUser().getEmail()/*"nicoly.d@aluno.ifsc.edu.br"*/;



var avalAlunos,aluno;
function dadosDoEmail_AE_7_8_25(mail,linha_aluno, questaoEmAula) {//linha_aluno vai ser o número do vínculo para aluno em mais de uma turma. Ex.: 1, 2 ou 3. Aí recalcula as ocorrências

  avalAlunos = PLANILHA.getSheetByName(PAGINA).getRange("B9:FJ").getValues(); //excluir l
    
  var permissoes,dadosTurma,textoEmail; 

  if(EMAILCHEFE.includes(E_MAIL_DETECTADO)||EMAILOLHADOR.includes(E_MAIL_DETECTADO)){   //Se for o chefe
    permissoes = (EMAILCHEFE.includes(E_MAIL_DETECTADO))?-1:-2;
    linha_aluno = linha_aluno || 9;
    aluno = avalAlunos[linha_aluno];
    dadosTurma = avalAlunos.slice(0,7);
    //////////////////////Cria lista de e-mails para escolha////////////////////////
    //ADICIONAR ÍNDICE E NOME
    textoEmail = "<input id='mailselected' list='opcoes_mail' name='browser' placeholder='Digite aqui' onClick='this.select();' onchange='atualizarTabela(this.value);' autocomplete='off'><datalist id='opcoes_mail'> <option value=\"\" /> ";
    for (var j = 0; j < avalAlunos.length; j++) {
     if(avalAlunos[j][1] === "VINDO"){textoEmail +="<option value='"+avalAlunos[j][2]+ "' />"+ 
     (JSON.parse("["+avalAlunos[j][0]+"]")+"").substring(0, 2)+ " || "+avalAlunos[j][3]+" || "+j;}
    };  
     
    textoEmail=textoEmail+"</datalist>";  // consolePlanilha("");

  }   
     //Se for aluno
        var ocorrencias = avalAlunos.filter(function(linha) {    return linha[2] === mail;  });
        var nOcorrencias = ocorrencias.length;

        switch (nOcorrencias) { 

          case 0:  //caso o e-mail não esteja na lista
            aluno = "não encontrado";
          break; 

          case 1:  //caso geral, só estando em uma turma
            linha_aluno = 0;
            var aluno = ocorrencias[linha_aluno];
            ocorrencias[linha_aluno][0] = JSON.parse(ocorrencias[linha_aluno][0]); //transforma em array: [ 'Pa', 9 ]
            dadosTurma = avalAlunos.slice(ocorrencias[linha_aluno][0][1]-9, ocorrencias[linha_aluno][0][1]-1);
            avalAlunos =""; //Limpar memória 
            textoEmail = textoEmail || mail;
          break; 

          default:    //Caso tenha mais de um vínculo
            linha_aluno = linha_aluno || 1;
            var aluno = ocorrencias[linha_aluno];
            var cabecalho = JSON.parse(ocorrencias[linha_aluno][0]); //transforma em array: [ 'Pa', 9 ]
            dadosTurma = avalAlunos.slice(cabecalho[1]-9, cabecalho[1]-1);

              //////////////////////Cria lista de e-mails para escolha////////////////////////
            if(textoEmail == undefined ){
              textoEmail = "<input id='mailselected' list='opcoes_mail' name='browser' placeholder='Digite aqui' onClick='this.select();' onchange='atualizarTabela(this.value);' autocomplete='off'><datalist id='opcoes_mail'> <option value=\"\" /> ";
              for (var j = 0; j < nOcorrencias; j++) {  
                textoEmail += "<option value='"+ocorrencias[j][2]+ "' />"+ JSON.parse(ocorrencias[j][0])[0] + " || " + (j+1);                        
              }; 
              textoEmail=textoEmail+"</datalist>";  // consolePlanilha(textoEmail)
            }
          break; 
        }

  
  

    var saida = [aluno,textoEmail,permissoes,dadosTurma];

    consolePlanilha("ABRE: "+dadosTurma+": FECHA");

    return saida;


}



//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\SAI//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
///////////////////ENCONTRA PARA O E-MAIL LOGADO TURMA, NOME E LINHA DO ALUNO NA ABA DA TURMA///////////////////
function dadosAlunos_AE_7_8_25(mail,questaoEmAula) {
  /////////////////Planilha de dados dos alunos//////////////////////
  var alunos = PLANILHA.getSheetByName("Alunos").getRange("C3:F300").getValues(),l = -1;
       
  //////////////////AJUSTAR PARA QUANDO O ALUNO ESTIVER EM DUAS TURMAS (caso do Marcelo - MM1 e MM2)
  for (var i = 4; i < 298; i++) { if (alunos[i][1] == mail) {l = i;/*consolePlanilha(alunos[i][1],alunos[i],i);*/ break} };
  // consolePlanilha("alunos[1][2]: "+alunos[1][2])
  // if(questaoEmAula){if(l>=0 && (alunos[0][0]) && (alunos[1][0] == alunos[l][0]) && (new Date((new Date().toString()).slice(0,16)+ (alunos[1][2].toString()).slice(16)) > new Date()) ){
  if(questaoEmAula){if(l>=0 && (alunos[0][0]) && (alunos[2][0] == alunos[l][0]) && (alunos[2][2] > new Date()) ){
                 //[TEXTO QUESTÃO, 1A2⟹AULA,     nQUESTÃO,      PRAZO,         nCARIMBOS]
    alunos[l].push([alunos[0][3],  alunos[0][1],  alunos[2][1],  alunos[2][2],  alunos[2][3]]);
  }}  //consolePlanilha([alunos[0][3],alunos[0][1],alunos[1][1],alunos[1][2],alunos[1][3]])


  // consolePlanilha(l>=0); consolePlanilha(questaoEmAula); consolePlanilha(alunos[0][0] == alunos[l][0])
  /////////////////Verifica se o aluno está no banco de dados//////////////////////
  return (l>=0)?alunos[l]:"não encontrado";//Saída: ['Pa','ezequiel.melo@ifsc.edu.br','Teste da Silva pa',14 ,[Dados da questão em aula]]//Antes = aluno = "não encontrado"
}











//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\SAI//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
function capturarEmail_AE_7_8_25(){return  /*RECEBER E-MAIL AQUI */"ezequiel.melo@ifsc.edu.br"; //Session.getActiveUser().getEmail()/*"nicoly.d@aluno.ifsc.edu.br"*/;
}



function linhadoemail_AE_7_8_25(turma,mail){ //var nlista = 1;          //Encontra a linha do e-mail ou seleciona a próxima vazia
  var sheet = PLANILHA.getSheetByName(turma), linhaencontrada = "";
  var mails = sheet.getRange("B14:B").getValues();
  for (var i = 0; i < mails.length; i++) { 
    if (mails[i] == mail) {linhaencontrada = i + 13; break; } };//Verifica a linha que está o e-mail          //Browser.msgBox(linha == "" , Browser. Buttons.OK); 

  return linhaencontrada;
}







function gravarExp_AE(nExp,turma,link){//consolePlanilha(nExp,turma,link);
  var email = capturarEmail_AE_7_8_25();
  var alunos = PLANILHA.getSheetByName(turma).getRange("B14:B113").getValues();
  
  var l = -1;  for (var i = 0; i < 298; i++) { if (alunos[i][0] == email) {l = i; break} };
  // var alunos = PLANILHA.getSheetByName(turma).getRange("X"+l+":EH"+l);
  PLANILHA.getSheetByName(turma).getRange(14+l,26+nExp, 1, 1).setValue(link);


  return "Sua resposta foi salva com sucesso!";
  }








function correcao_AE_01_08_25(respondidos,variav,selectrow,turma,nlista){ //console.log(respondidos,variav,"selectrow:",selectrow,"sheet:","nlista:",nlista);
        var sheet = PLANILHA.getSheetByName(turma);
        var resposta = (respondidos.replaceAll(/🠖\"(false|true)\"⦆/g,"🠖$1⦆")).match(/(?<=⦅).*?(?=⦆)/gm);   //retira aspas dos booleanos e separa  respostas
        if(resposta != null){
              //importa variáveis, separa em [questão,,nome,,variável]           && variav != ""
        var variaveis = [];
              //Se tiverem variáveis submetidas usar elas
        //var posicaovariaveis = sheet.getRange(selectrow,165+15*(nlista-1), 1, 1).getValue();//puxar variáveis subm.
        //if(posicaovariaveis != ""){variav = posicaovariaveis;}
              //Se houver variáveis extrair todas para: 'variáveis'
      if(variav != ""){variav.match(/(?<=⦅).*?(?=⦆)/gm).forEach(function(c){variaveis.push(c.split(/[🠚🠖]/))})};  
              //importa geradores de formulários(F~~F) e os separa em array de arrays
        var geraForm = [];       (sheet.getRange(10,160+15*(nlista-1),1,1).getValue()).match(/(?<=\(F~).*?(?=~F\))/gm).forEach(function(c){geraForm.push(c. split(/[~]/))});     // consolePlanilha("Forms: "+geraForm);
              //Tirar aspas para deixar true e false como booleanos
              //Recebe valores submetidos na lista da outra função, separa em [questão,,r{id},,respondido]
        var resp = [];      resposta.forEach(function(c){resp.push((c.replace(/([0-9][0-9])🠚id\{(.*?)\}🠖(.*?)/,"$1ꕒꕒr{$2}ꕒꕒ$3")).split("ꕒ"))}); 

      var contaNUM = [];     geraForm.forEach(function(c){contaNUM.push(c[8].replace(/^ABS\(r\{(.*?)\}\/(.*)-1\)<.*%/,c[0]+"ꕒg{$1}ꕒ$2").split("ꕒ"))});   contaNUM = contaNUM.filter(function(va) {  return va.length==3;});   //consolePlanilha(contaNUM);

        //consolePlanilha("variaveis: ❗"+variaveis.join("❗")+"❗\n\nresp:  ❗"+resp.join("❗")+"❗\n\ncontaNUM:  ❗"+contaNUM.join("❗")+"❗");

        var funcoes = [],nota=[],notamaxima=[];//consolePlanilha(geraForm);
        for(i=0;i<geraForm.length;i++){ 
        var funcao = geraForm[i][2]+"*IF("+geraForm[i][8]+";1;"+geraForm[i][6]+")",funcaoinicial = "";
        while (funcaoinicial != funcao) {//Repete enquanto tiver novos dados a serem substituidos que puxam outros dados
          funcaoinicial = funcao;
          variaveis.forEach(function(c){if(geraForm[i][0]==c[0]){funcao = funcao.replaceAll(c[2],c[4])}});//consolePlanilha(funcao);
          resp.forEach(function(c){if(geraForm[i][0]==c[0]){funcao = funcao.replaceAll(c[2],c[4])}});
          contaNUM.forEach(function(c){if(geraForm[i][0]==c[0]){funcao = funcao.replaceAll(c[1],c[2])}}); 
        };
        // variaveis.forEach(function(c){if(geraForm[i][0]==c[0]){funcao = funcao.replaceAll(c[2],c[4])}});
        if(funcao.match(/r\{.*}/i)==null){//consolePlanilha(funcoes);
          funcoes.push('" "&IFERROR(IF('+funcao+'>0;"✅";"❌")&"'+((geraForm[i][7]=='SHOW')?"👁":"🔒")+'"&"      "&TEXT('+funcao+';\"0.00\")&\"       '+geraForm[i][0]+'🠚id{'+geraForm[i][1]+'}          '+(funcao.replaceAll(/^\d,\d\*IF\((.*);1;-\d*%\)/g,"$1")).replaceAll("\"","\"\"")+'\"&CHAR(10))');     //consolePlanilha(funcao);
          nota.push(funcao); }; 
          if(geraForm[i][2].match(/\*/i)==null){notamaxima.push(geraForm[i][2])};//Se encontra "*" (é pq é opcional) e não soma
        };
        var devolver = '=SPLIT(TEXT(MAX(0;\nIFERROR('+nota.join(")\n+IFERROR(")+')\n);"0.0")&\" de \"&TEXT('+notamaxima.join("+")+'\n;"0.0")&\n\"␑=✓ 👀 |  Pontos | Referência   |   Cálculos\"&CHAR(10)&\n'+funcoes.join("&\n")+';\"␑\";;)'; 
        sheet.getRange(selectrow,168+15*(nlista-1), 1, 1).setValue(devolver);   //console.log("devolver: ",devolver);//Nota
  }}










/*  
        //////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////PREPARA O GABARITO PARA O CHEFE//////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////////
function solucoesDoChefe_AE_7_8_25(variaveis, formularios, nQuestaoBanco){try{ 

  // Variávei usadas: mail
  //////////Acumulará os gabaritos com a tag <meugab>////////////
  let solucoesChefe = "";
  //////////Só funciona se for o chefe logado////////////
  if(EMAILCHEFE.includes(E_MAIL_DETECTADO)){  // var formul = sheet.getRange(10, 160+15*(nlista-1)).getValue(); //emfoco
    //////////Declara o número da primeira questão e o texto de formatação HTML////////////
    var a=["01"],forms = [`<meugab id="r-`+a[0]+`"><button onclick="var t = document.getElementById('rtxt-`+a[0]+`'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';">R-`+a[0]+`</button><meugabtxt  id="rtxt-`+a[0]+`" onfocus="sinalizarParenteses(this)"  onmouseup="corrigirPorSelecao(this)"  contenteditable="true" style="white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;">`],nPerg = "01", addVariav = "variaveis não adicionadas";   
        // console.log("variaveis: ",variaveis)

    //////////Retira conteúdo dos "(F~...~F)"////////////
    formularios.match(/(?<=\(F~).*?(?=~F\))/gm).forEach(
        function(c){
          var a = c.split(/[~]/);   // consolePlanilha(a);  

          if(addVariav=="variaveis não adicionadas"){       addVariaveis();        };
          function addVariaveis(){
            for (var f = 0;f < variaveis.length; f++) { 
              if(new RegExp("\\⦅" + a[0] + "\\🠚", "g").test(variaveis[f])){
                // consolePlanilha(respostasSalvas[f][0].replace(/⦅.*?🠚(.*?)🠖(.*?)⦆/,"([$1=$2])"))
                forms.push("<b style='color:Green;'>"+variaveis[f][0].replace(/⦅.*?🠚(.*?)🠖(.*?)⦆/,"([$1=$2])")+"</b>");
              }; 
              addVariav = "variaveis adicionadas 1 vez";   //Para fechar o div e passar para a próxima pergunta
            }
          };

          if(a[0]==nPerg){
            forms.push("\n<b style='color:black;'>"+a[0]+"🠚"+a[1]+": </b>"+a[8]);

          }else{
            forms.push("<br><b style='color:red;'>BQ: " + nQuestaoBanco[parseInt(a[0])-2] + `</b></meugabtxt></meugab>`+`<meugab id="r-`+a[0]+`"><button onclick="var t = document.getElementById('rtxt-`+a[0]+`'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';">R-`+a[0]+`</button><meugabtxt  id="rtxt-`+a[0]+`" onfocus="sinalizarParenteses(this)"  onmouseup="corrigirPorSelecao(this)"   contenteditable="true" style="white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;">`);
            addVariaveis();
            // addVariav = "variaveis não adicionadas"; 
            forms.push("\n<b style='color:black;'>"+a[0]+"🠚"+a[1]+": </b>"+a[8]);
          };
          // forms.push("<br>BQ: " + nQuestaoBanco.at(-1));
          // consolePlanilha(a[0]+"-"+a[1]+" e "+nPerg+" e "+addVariav);
            nPerg = a[0];
        }
    );           //consolePlanilha(valEvariaveis[1]);
    //////////Gabaritos do Chefe visíveis no site das listas com a tag <meugab>////////////
    solucoesChefe = (forms.join(" "))+"<br><b style='color:red;'>BQ: " + nQuestaoBanco.at(-1)+"</b>";
  };

  //consolePlanilha(solucoesChefe);
  return solucoesChefe;
  
}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}

*/














//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\SAI//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//\\//
var emailADM = "ezequiel.melo@ifsc.edu.br";  // = ["ezequiel.melo@ifsc.edu.br", "usuario@email.com", "admin@email.com"];

function puxarListaAE28_6_25(nlista,turma,mail){try{       /////////////////////////////Dados das listas/////////////////////////////////////////
  var sheet = PLANILHA.getSheetByName(turma);
  var linhaencontrada = linhadoemail_AE_7_8_25(turma,mail);
  var dadosComuns = sheet.getRange(4, 157+15*(nlista-1), 7, 3).getValues();
  if(dadosComuns[1][1]){
      //Puxar questões  
  // var questoes = sheet.getRange(linhaencontrada + 1, 157+15*(nlista-1), 1, 1).getValue();

  var respostas =  sheet.getRange(linhaencontrada + 1, 167+15*(nlista-1), 1, 1).getValue();

  if (linhaencontrada == ""){
    var valEvariaveis = substitui(dadosComuns[6][0],mail).concat("ausente"),lastFB = "";} //substitui() = retorna [Texto substituído, variáveis]
  else{  
    var valEvariaveis = substitui(dadosComuns[6][0],mail).concat(respostas),lastFB = sheet.getRange(linhaencontrada + 1, 163+15*(nlista-1), 1, 1).getValue();};
      
      ////////////////////////////////Hora do feedback(obsoleto)////////////////////////////////////////
  //            var fb = "<br><input type='checkbox' id='FB'><label id='textoFB' for='FB' style='color: #efd8aa'>Solicitar feedback de acertos junto ao e-mail de confirmação (disponível a cada " + (dadosComuns[3][1].toString()).replace(".",",") + "h).</label>";

  } 

  else{var valEvariaveis = ["",]
  //,fb = ""
  }
  // fb = (Date.parse(sheet.getRange(linhaencontrada + 1, 163+15*(nlista-1), 1, 1).getValue())+prazo*3600000)-Date.now();
  //consolePlanilha(fb);   consolePlanilha(dadosComuns[1][2].hmsDMA());
  //consolePlanilha(["<h3>" + dadosComuns[0][1] + "</h3>\n" + valEvariaveis[0],valEvariaveis[1],fb,submitText]); 
        ////////////////////////////////Hora do feedback////////////////////////////////////////
  var prazo = dadosComuns[3][1];

  /////////////////////////Se for o ADM entrando no sistema capturar a célula dos formulários ('FD10' + n*15)/////////////////////////////////
  var solucoes = "";
  if(capturarEmail_AE_7_8_25()==emailADM){  // var formul = sheet.getRange(10, 160+15*(nlista-1)).getValue(); //emfoco
      var a=["01"],forms = [`<meugab id="r-`+a[0]+`"><button onclick="var t = document.getElementById('rtxt-`+a[0]+`'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';">R-`+a[0]+`</button><meugabtxt  id="rtxt-`+a[0]+`" onfocus="sinalizarParenteses(this)"  onmouseup="corrigirPorSelecao(this)"  contenteditable="true" style="white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;">`],nPerg = "01", addVariav = "variaveis não adicionadas";   
      (sheet.getRange(10, 160+15*(nlista-1)).getValue()).match(/(?<=\(F~).*?(?=~F\))/gm).forEach(
        function(c){
          var a = c.split(/[~]/);   // consolePlanilha(a);  

          if(addVariav=="variaveis não adicionadas"){       addVariaveis();        };
          function addVariaveis(){
            for (var f = 0;f < valEvariaveis[1].length; f++) { 
              if(new RegExp("\\⦅" + a[0] + "\\🠚", "g").test(valEvariaveis[1][f])){
                // consolePlanilha(valEvariaveis[1][f][0].replace(/⦅.*?🠚(.*?)🠖(.*?)⦆/,"([$1=$2])"))
                forms.push("<b style='color:Green;'>"+valEvariaveis[1][f][0].replace(/⦅.*?🠚(.*?)🠖(.*?)⦆/,"([$1=$2])")+"</b>");
              }; 
              addVariav = "variaveis adicionadas 1 vez";   //Para fechar o div e passar para a próxima pergunta
            }
          };

          if(a[0]==nPerg){
            forms.push("\n<b style='color:black;'>"+a[0]+"🠚"+a[1]+": </b>"+a[8]);

          }else{
            forms.push(`</meugabtxt></meugab>`+`<meugab id="r-`+a[0]+`"><button onclick="var t = document.getElementById('rtxt-`+a[0]+`'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';">R-`+a[0]+`</button><meugabtxt  id="rtxt-`+a[0]+`" onfocus="sinalizarParenteses(this)"  onmouseup="corrigirPorSelecao(this)"   contenteditable="true" style="white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;">`);
            addVariaveis();
            // addVariav = "variaveis não adicionadas"; 
            forms.push("\n<b style='color:black;'>"+a[0]+"🠚"+a[1]+": </b>"+a[8]);
          };
          
          // consolePlanilha(a[0]+"-"+a[1]+" e "+nPerg+" e "+addVariav);
            nPerg = a[0];
        }
      );           //consolePlanilha(valEvariaveis[1]);
      solucoes = (forms.join(" "));
      // consolePlanilha(solucoes + "</div></div>");
      // solucoes = '<textarea style="height: 470px; width: 1388px;" onmouseup="alert(this.value.substring(this.selectionStart,this.selectionEnd));">'+forms.join("\n")+valEvariaveis[1].join("\n")+"</textarea>";
  };

  //return [Título + HTML substituído,variáveis,[data último fb,intervalo p/ solicitar],[data validade lista],respostas,dados]
  return ["<h2 style='text-align:center;'>" + dadosComuns[0][1] + "</h2>\n<br>" + valEvariaveis[0] + solucoes,valEvariaveis[1],[lastFB,prazo],[Date.parse(dadosComuns[1][2]),dadosComuns[1][2].hmsDMA()],valEvariaveis[2],dadosComuns[0][2]];
}catch(e){consolePlanilha(`ERRO: ${e.stack}`);}}      
  //HTML perguntas,Variáveis,Feedback,Validade 
































  
function testarfuncoes(){         // consolePlanilha("nn".split('|'))
/*
var pesos = [ [ 7, 1, 2, 1 ],[ 4, 1, 3, 1 ], [ 4, 1, 2, 3 ], [ 4, 4, 1, 1 ] ];
var avalPessoal = PLANILHA.getSheetByName("Pa").getRange("D14").getValue()
//"[ [ 6, 1, 2, 1 ],, [ 4, 1, 2, 3 ], [ 4, 4, 1, 1 ] ]";
//Coloca as avaliações pessoais para os alunos caso elas existam na coluna D
if(avalPessoal != ""){
  var avalPessoal = eval(avalPessoal);  //  consolePlanilha(avalPessoal);  //Transforma o texto em array
  const avalPessoalTransp = avalPessoal[0].map((coluna, index) => avalPessoal.map(linha => linha[index]));    //consolePlanilha(avalPessoalTransp);   //Tranpõe o array pra ficar igual o dos pesos

for(var i = 0; i < 4 ; i++){  // Substitui pessos pessoais em branco pelos pesos coletivos
  for(var j = 0; j < 4 ; j++){  //consolePlanilha(avalPessoalTransp[i][j]);
    if(avalPessoalTransp[i][j]==undefined){   avalPessoalTransp[i][j] = pesos[i][j]   };  
  }  
};    //consolePlanilha(avalPessoalTransp);
}
*/





  ////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////Escolher função para testar://////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////
  var mail              = "ezequiel.melo@ifsc.edu.br",
      turma             = "Pa",
      nlista            = 1, nVinculo,
      nColVD            = 211,
      nPergunta         = 2,
      resposta          = '"⦅01🠚id{a}🠖13,918⦆","⦅01🠚id{b}🠖4,4⦆","⦅01🠚id{c}🠖32⦆","⦅02🠚id{a}🠖0,3⦆","⦅02🠚id{b}🠖7⦆","⦅02🠚id{e1}🠖\"positivo\"⦆","⦅02🠚id{e2}🠖\"n1 > n2\"⦆","⦅02🠚id{f}🠖42⦆","⦅03🠚id{2000}🠖\"2000\"⦆","⦅04🠚id{lilás}🠖\"☐\"⦆","⦅04🠚id{amarelo}🠖\"amarelo\"⦆","⦅04🠚id{vermelho}🠖\"☐\"⦆","⦅04🠚id{rosa}🠖\"rosa\"⦆","⦅04🠚id{azul}🠖\"azul\"⦆","⦅05🠚id{d}🠖\"true\"⦆","⦅05🠚id{c}🠖\"false\"⦆","⦅05🠚id{b}🠖\"true\"⦆","⦅05🠚id{e}🠖\"false\"⦆","⦅05🠚id{a}🠖\"true\"⦆"',
      variaveis         = [["⦅01🠚p₁₆🠖680⦆"],["⦅01🠚p₂₅🠖540⦆"],["⦅01🠚p₃₄🠖350⦆"],["⦅01🠚V₁🠖0,05⦆"],["⦅01🠚V₂🠖0,27⦆"],["⦅01🠚V₃🠖0,58⦆"],["⦅01🠚V₄🠖0,77⦆"],["⦅01🠚V₅🠖0,83⦆"],["⦅01🠚V₆🠖0,91⦆"],["⦅01🠚n🠖0,12⦆"],["⦅01🠚T₅₆🠖280⦆"],["⦅02🠚n1🠖4,50⦆"],["⦅02🠚n2🠖-4,199⦆"],["⦅05🠚a1🠖\"pizza\"⦆"],["⦅05🠚a2🠖\"cilíndrica\"⦆"],["⦅05🠚b1🠖\"galo\"⦆"],["⦅05🠚b2🠖\"\"⦆"],["⦅05🠚b3🠖\"3\"⦆"],["⦅05🠚c1🠖\"2\"⦆"]]
,
      //selectrow         = linhadoemail_AE_7_8_25(turma,mail)+1, 
      // respondidos       = PLANILHA.getSheetByName(turma).getRange(selectrow, 167+15*(nlista-1), 1, 1).getValue(),
      // variav            = PLANILHA.getSheetByName(turma).getRange(selectrow, 165+15*(nlista-1), 1, 1).getValue(),
      link="oLink", htmlPergResp = `<p id=\"perguntasaqui\" style=\"padding: 12px; margin-top: -20px; display: block; pointer-events: auto; opacity: 1;\"><h2 style=\"text-align:center;\">Grandezas físicas</h2>\n<br><p><img src=\"https://lh3.googleusercontent.com/u/0/docs/AOD9vFrlUKgEZucIY6qW6M44ri4vk6fdMzjIx8jq2x5Cvskl9EnyImDqf06wwytcCo-cZkilsG8Eqd6r9Ftaf5sFtRluJEd4pkvyOh8zuxQWLwgSEKWCGqzM_5I4QQ4rCPqpyW9rmOHD28xUoHY0pPIUGPV7qf30zdLksvWMX-X60FGBpPvI3fx5AHvy8mxcj51CItqi73cYxwJJ18_uWwQfukrydaiczukRfyokmdYPzRC7ep6kZjihU6LGtbzqbGSjgeJKpSLviuuJl3y-5D_OCijvMJpdgY0dCRX7p43rTdD5_8jCw-nVMHMLqhdRST9dABb8bBA0hd0S4DIr-jKsAEFkuLQsJBUzG7nue35nYDz3vuAN8WVeg3-QlJfnrneW_q7dk9B4ob6KB_napoqGPYh2gKHorVeiBw-garZ-a_rBFszXezeD4kQQA5TtF76kvcevkWp8tMFJHSMH5PqvkdMKQcLryDZo2bwUxIqTwq3t_GKmTMOTC9Un8hntTUJzPY3y7GGE4C7wjJbTWoG50X_6nUK-7HqAnxCEWPMfOh_496gMJ9udlITGUO_2_i5Sr73coj8itzpqqcbY5BQBGHx6hxrr-NAZpVr7Fv9JbgMn6X0wZ3xDvtqWrQVLiRvFJfd7kEptIfoz18mkzAU9mCJDxq6k3w5Ldyi8KpfIy09KaN_UOCetlJHfxMHGGflKoXHMHlg8r5-A4L_7HG5GuMNoRSqW_HTdGZy1_qOVk-7ENEQ97oDTPZLc3o4C3qHh_HarPY1QhV6KonDOrG5H7jGPKdrzRS0pPx0iciGRNvAV7qDPvGFW1zC2hC72MThA6oE7xdyWaEvNPmUVzF5ukm9jPse6sq3zX4R5Ynk0PCh33M2O-hSCEMSB3dqiIKbwhC5cv5x1WcH2xTdNbb9rFeXtTGQwmwjajeeHMoOzhPl1FUQRdBveFdqM0MnoR3j8I27iblelnehQSU22EhgY1KfRheLnNPzd4dvP1pU4IdfoWEhygN0dnlcccog6KMNR3PGuDi-B9d-HrvWjyzxYI4xKPwSGeoAjmWSSVULsG2r6\" height=\"300px\" align=\"right\" style=\"display:block;filter:drop-shadow(1px 1px 7px white);padding:10px;\"> ⟪01⟫ <b style=\"color:Gray;\">[1,5]</b> O valores nos eixos de cada ponto enumerado no gráfico que cruza as isotermas são dados por: p₁ = p₆ = 680; p₂ = p₅ = 540; p₃ = p₄ = 350; V₁ = 0,05; V₂ = 0,27; V₃ = 0,58; V₄ = 0,77; V₅ = 0,83; V₆ = 0,91. Para este gás ideal:<br> (a) Determine o valor da razão T₁ / T₂: <span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"01🠚id{a}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"\" value=\"13,918\">  <b></b>  <sup class=\"peso\">✓(+ 33.3%) ou  メ(- 0.0%)</sup></span>. <br> (b) Se o gás possuir 0,12 mol determine o valor de T₃: <span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"01🠚id{b}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"\" value=\"4,4\">  <b></b>  <sup class=\"peso\">✓(+ 26.7%) ou  メ(- 0.0%)</sup></span> K.<br> (c) Determine o número de moles para que T₅ + T₆ = 280 K: <span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"01🠚id{c}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"\" value=\"32\">  <b></b>  <sup class=\"peso\">✓(+ 40.0%) ou  メ(- 0.0%)</sup></span> mol.<br><br><br><br></p><meugab id=\"r-01\"><button onclick=\"var t = document.getElementById('rtxt-01'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';\">R-01</button><meugabtxt id=\"rtxt-01\" onfocus=\"sinalizarParenteses(this)\" onmouseup=\"corrigirPorSelecao(this)\" contenteditable=\"true\" style=\"white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;\"> <b style=\"color:Green;\">([p₁₆=680])</b> <b style=\"color:Green;\">([p₂₅=540])</b> <b style=\"color:Green;\">([p₃₄=350])</b> <b style=\"color:Green;\">([V₁=0,05])</b> <b style=\"color:Green;\">([V₂=0,27])</b> <b style=\"color:Green;\">([V₃=0,58])</b> <b style=\"color:Green;\">([V₄=0,77])</b> <b style=\"color:Green;\">([V₅=0,83])</b> <b style=\"color:Green;\">([V₆=0,91])</b> <b style=\"color:Green;\">([n=0,12])</b> <b style=\"color:Green;\">([T₅₆=280])</b> \n<b style=\"color:black;\">01🠚a: </b>ABS(r{a}/(     (p₁₆*V₁)/(p₂₅*V₂)     )-1)&lt;1% \n<b style=\"color:black;\">01🠚b: </b>ABS(r{b}/(     (p₃₄*V₃)/(8,31*n)     )-1)&lt;2% \n<b style=\"color:black;\">01🠚c: </b>ABS(r{c}/(     (p₂₅*V₅ + p₁₆*V₆)/(8,31*T₅₆)     )-1)&lt;2% <br><b style=\"color:red;\">BQ: 182</b></meugabtxt></meugab><p><img src=\"https://cnsdbh.com.br/wordpress/wp-content/uploads/2020/05/Prancheta-02.png\" height=\"150px\" align=\"right\" style=\"display:block;filter:drop-shadow(1px 1px 7px white);padding:10px;\"> ⟪02⟫ <b style=\"color:Gray;\">[3,6]</b> Realize as operações matemáticas com n₁ = 4,50 e n₂ = -4,199:<br> (a) Some n₁ com n₂. <span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"02🠚id{a}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"Número real\" value=\"13,918\">  <b></b>  <sup class=\"peso\">✓(+ 2.8%) ou  メ(- 0.0%)</sup></span><br> (b) Subtraia n₁ de n₂.<span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"02🠚id{b}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"Número sem unidade\" value=\"7\">  <b></b>  <sup class=\"peso\">✓(+ 5.6%) ou  メ(- 0.0%)</sup></span><br> (c) Divida cada número pelo outro:<span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"02🠚id{c1}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"Divida n₁ por n₂\" value=\"\">  <b></b>  <sup class=\"peso\">✓(+ 8.3%) ou  メ(- 0.0%)</sup></span> e <span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"02🠚id{c2}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"Divida n₂ por n₁\" value=\"\">  <b></b>  <sup class=\"peso\">✓(+ 11.1%) ou  メ(- 0.0%)</sup></span><br> (d) Escreva n₁ dividido por n₂ em formato fracionário.<span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"02🠚id{d}\" pattern=\"^&quot;[+\\-]?\\d+(,\\d+)?\\/[+\\-]?\\d+(,\\d+)?&quot;$\" placeholder=\"Ex.: &quot;2,65/-4,452&quot;\" value=\"\">  <b></b>  <sup class=\"peso\">✓(+ 13.9%) ou  メ(- 4.2%)</sup></span><br> (e) A subtração de n₁ de n₂ tem resultado <span class=\"answer\"><select class=\"inputes\" id=\"02🠚id{e1}\"><option value=\"\">- - -  -</option><option value=\"positivo\" selected=\"selected\">positivo</option><option value=\"negativo\">negativo</option></select>  <sup class=\"peso\">✓(+ 16.7%) ou  メ(- 16.7%)</sup></span> pois <span class=\"answer\"><select class=\"inputes\" id=\"02🠚id{e2}\"><option value=\"\">- - -  -</option><option value=\"n1 &gt; n2\" selected=\"selected\">n1 &gt; n2</option><option value=\"n2 &gt; n1\">n2 &gt; n1</option></select>  <sup class=\"peso\">✓(+ 19.4%) ou  メ(- 19.4%)</sup></span>.<br> (f) Some os resultados dos itens (a) e (b) com 100.<span class=\"answer\"><input class=\"inputes\" type=\"text\" id=\"02🠚id{f}\" pattern=\"^[+\\-]?\\d+(,\\d+)?((e|E)[+\\-]?\\d+)?$\" placeholder=\"Número sem unidade\" value=\"42\">  <b></b>  <sup class=\"peso\">✓(+ 22.2%) ou  メ(- 0.0%)</sup></span></p><meugab id=\"r-02\"><button onclick=\"var t = document.getElementById('rtxt-02'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';\">R-02</button><meugabtxt id=\"rtxt-02\" onfocus=\"sinalizarParenteses(this)\" onmouseup=\"corrigirPorSelecao(this)\" contenteditable=\"true\" style=\"white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;\"> <b style=\"color:Green;\">([n1=4,50])</b> <b style=\"color:Green;\">([n2=-4,199])</b> \n<b style=\"color:black;\">02🠚a: </b>ABS(r{a}/(     n1+n2     )-1)&lt;2% \n<b style=\"color:black;\">02🠚b: </b>ABS(r{b}/(     n2-n1     )-1)&lt;2% \n<b style=\"color:black;\">02🠚c1: </b>OR(ABS(r{c1}/(     n1/n2     )-1)&lt;2%;ABS(r{c1}/(     n2/n1     )-1)&lt;2%) \n<b style=\"color:black;\">02🠚c2: </b>AND(r{c1}&lt;&gt;r{c2};OR(ABS(r{c2}/(     n1/n2     )-1)&lt;2%;ABS(r{c2}/(     n2/n1     )-1)&lt;2%)) \n<b style=\"color:black;\">02🠚d: </b>r{d}=\"n1\"&amp;\"/\"&amp;\"n2\" \n<b style=\"color:black;\">02🠚e1: </b>r{e1}=IF(n2&gt;n1;\"positivo\";\"negativo\") \n<b style=\"color:black;\">02🠚e2: </b>r{e2}=IF(n2&gt;n1;\"n2 &gt; n1\";\"n1 &gt; n2\") \n<b style=\"color:black;\">02🠚f: </b>ABS(r{f}/(     g{a}-g{b}+100     )-1)&lt;2% <br><b style=\"color:red;\">BQ: 3*</b></meugabtxt></meugab><p><img src=\"https://midias.agazeta.com.br/2020/04/22/descobrimento-do-brasil-chegada-dos-portugueses-ainda-deixa-marcas-na-politica-brasileira-233030-article.jpg\" height=\"250px\" align=\"right\" style=\"display:block;filter:drop-shadow(1px 1px 7px white);padding:10px;\"> ⟪03⟫ <b style=\"color:Gray;\">[2,0]</b><span class=\"answer\"> Em que ano o Brasil foi descoberto pelos portugueses?       <button class=\"limpar\" onclick=\"document.getElementsByName('03').forEach(function(c){(c.disabled == true)?c.disabled = false:c.disabled = true;});\">Isenção</button><sup class=\"peso\">✓(+ 100%) ou  メ(- 50.0%)</sup></span> <br>(a) <input type=\"radio\" class=\"inputes\" name=\"03\" id=\"03🠚id{2500}\" value=\"2500\">  <label for=\"03🠚id{2500}\">Em 2500 d.C.;</label> <br>(b) <input type=\"radio\" class=\"inputes\" name=\"03\" id=\"03🠚id{500}\" value=\"500\">  <label for=\"03🠚id{500}\">Em 500 d.C.;</label> <br>(c) <input type=\"radio\" class=\"inputes\" name=\"03\" id=\"03🠚id{1500}\" value=\"1500\">  <label for=\"03🠚id{1500}\">Em 1500 d.C.;</label> <br>(d) <input type=\"radio\" class=\"inputes\" name=\"03\" id=\"03🠚id{2000}\" value=\"2000\" checked=\"\">  <label for=\"03🠚id{2000}\">Em 2000 d.C.;</label> <br>(e) <input type=\"radio\" class=\"inputes\" name=\"03\" id=\"03🠚id{1000}\" value=\"1000\">  <label for=\"03🠚id{1000}\">Em 1000 d.C.;</label></p><meugab id=\"r-03\"><button onclick=\"var t = document.getElementById('rtxt-03'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';\">R-03</button><meugabtxt id=\"rtxt-03\" onfocus=\"sinalizarParenteses(this)\" onmouseup=\"corrigirPorSelecao(this)\" contenteditable=\"true\" style=\"white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;\"> \n<b style=\"color:black;\">03🠚500: </b>r{500}=\"NAO\" \n<b style=\"color:black;\">03🠚1000: </b>r{1000}=\"NAO\" \n<b style=\"color:black;\">03🠚1500: </b>r{1500}=\"1500\" \n<b style=\"color:black;\">03🠚2000: </b>r{2000}=\"NAO\" \n<b style=\"color:black;\">03🠚2500: </b>r{2500}=\"NAO\" <br><b style=\"color:red;\">BQ: 4</b></meugabtxt></meugab><p><img src=\"https://static.todamateria.com.br/upload/ba/nd/bandeira-do-brasil-og.jpg\" height=\"150px\" align=\"right\" style=\"display:block;filter:drop-shadow(1px 1px 7px white);padding:10px;\"> ⟪04⟫ <b style=\"color:Gray;\">[2,0]</b> Quais cores estão presentes na bandeira brasileira?       <button class=\"limpar\" onclick=\"document.getElementsByName('04').forEach(function(c){(c.disabled == true)?c.disabled = false:c.disabled = true;});\">Isenção</button><br>(a) <span class=\"answer\"><input type=\"checkbox\" class=\"inputes\" name=\"04\" id=\"04🠚id{lilás}\" value=\"lilás\"> <label for=\"04🠚id{lilás}\">Lilás;</label>     <sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span><br>(b) <span class=\"answer\"><input type=\"checkbox\" class=\"inputes\" name=\"04\" id=\"04🠚id{amarelo}\" value=\"amarelo\" checked=\"\"> <label for=\"04🠚id{amarelo}\">Amarelo;</label>     <sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span><br>(c) <span class=\"answer\"><input type=\"checkbox\" class=\"inputes\" name=\"04\" id=\"04🠚id{vermelho}\" value=\"vermelho\"> <label for=\"04🠚id{vermelho}\">Vermelho;</label>     <sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span><br>(d) <span class=\"answer\"><input type=\"checkbox\" class=\"inputes\" name=\"04\" id=\"04🠚id{rosa}\" value=\"rosa\" checked=\"\"> <label for=\"04🠚id{rosa}\">Rosa;</label>     <sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span><br>(e) <span class=\"answer\"><input type=\"checkbox\" class=\"inputes\" name=\"04\" id=\"04🠚id{azul}\" value=\"azul\" checked=\"\"> <label for=\"04🠚id{azul}\">Azul;</label>     <sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span><br></p><meugab id=\"r-04\"><button onclick=\"var t = document.getElementById('rtxt-04'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';\">R-04</button><meugabtxt id=\"rtxt-04\" onfocus=\"sinalizarParenteses(this)\" onmouseup=\"corrigirPorSelecao(this)\" contenteditable=\"true\" style=\"white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;\"> \n<b style=\"color:black;\">04🠚amarelo: </b>r{amarelo}=\"amarelo\" \n<b style=\"color:black;\">04🠚rosa: </b>r{rosa}=\"NAO\" \n<b style=\"color:black;\">04🠚azul: </b>r{azul}=\"azul\" \n<b style=\"color:black;\">04🠚lilás: </b>r{lilás}=\"NAO\" \n<b style=\"color:black;\">04🠚vermelho: </b>r{vermelho}=\"NAO\" <br><b style=\"color:red;\">BQ: 5*</b></meugabtxt></meugab><p><img src=\"\" height=\"px\" align=\"right\" style=\"display:block;filter:drop-shadow(1px 1px 7px white);padding:10px;\"> ⟪05⟫ <b style=\"color:Gray;\">[2,0]</b> Avalie cada afirmativa como VERDADEIRA ou FALSA.      <br>(a) O sol só aparece durante o dia;<span class=\"answer\"><select class=\"inputes\" id=\"05🠚id{d}\"> <option value=\"\">- - - -</option><option value=\"true\" selected=\"selected\">Verdadeira</option><option value=\"false\">Falsa</option></select><sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span> <br>(b) Um pato monogâmico tem 2 pata(s);<span class=\"answer\"><select class=\"inputes\" id=\"05🠚id{c}\"> <option value=\"\">- - - -</option><option value=\"true\">Verdadeira</option><option value=\"false\" selected=\"selected\">Falsa</option></select><sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span> <br>(c) Um galo  tem apenas 3 pata(as);<span class=\"answer\"><select class=\"inputes\" id=\"05🠚id{b}\"> <option value=\"\">- - - -</option><option value=\"true\" selected=\"selected\">Verdadeira</option><option value=\"false\">Falsa</option></select><sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span> <br>(d) O Hulk é azul;<span class=\"answer\"><select class=\"inputes\" id=\"05🠚id{e}\"> <option value=\"\">- - - -</option><option value=\"true\">Verdadeira</option><option value=\"false\" selected=\"selected\">Falsa</option></select><sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span> <br>(e) A pizza é cilíndrica;<span class=\"answer\"><select class=\"inputes\" id=\"05🠚id{a}\"> <option value=\"\">- - - -</option><option value=\"true\" selected=\"selected\">Verdadeira</option><option value=\"false\">Falsa</option></select><sup class=\"peso\">✓(+ 20.0%) ou  メ(- 20.0%)</sup></span></p><meugab id=\"r-05\"><button onclick=\"var t = document.getElementById('rtxt-05'); t.style.display = (t.style.display === 'none') ? 'block' : 'none';\">R-05</button><meugabtxt id=\"rtxt-05\" onfocus=\"sinalizarParenteses(this)\" onmouseup=\"corrigirPorSelecao(this)\" contenteditable=\"true\" style=\"white-space:pre-line;border-width: 5px;border-style: inset;color:Grey;resize: both; overflow: auto;background:white;display:none;\"> <b style=\"color:Green;\">([a1=\"pizza\"])</b> <b style=\"color:Green;\">([a2=\"cilíndrica\"])</b> <b style=\"color:Green;\">([b1=\"galo\"])</b> <b style=\"color:Green;\">([b2=\"\"])</b> <b style=\"color:Green;\">([b3=\"3\"])</b> <b style=\"color:Green;\">([c1=\"2\"])</b> \n<b style=\"color:black;\">05🠚a: </b>r{a}=OR(AND(a1=\"terra\";a2=\"esférica\");AND(a1=\"pizza\";a2=\"plana\")) \n<b style=\"color:black;\">05🠚b: </b>r{b}=OR(AND(b1=\"galo\";b2=\"\";b3=\"2\");AND(b1=\"cachorro\";b2=\"\";b3=\"4\");AND(b1=\"boi\";b2=\"\";b3=\"4\");AND(b1=\"galo\";b2=\"não\";b3=\"1\");AND(b1=\"galo\";b2=\"não\";b3=\"3\");AND(b1=\"galo\";b2=\"não\";b3=\"4\");AND(b1=\"cachorro\";b2=\"não\";b3=\"1\");AND(b1=\"cachorro\";b2=\"não\";b3=\"2\");AND(b1=\"cachorro\";b2=\"não\";b3=\"3\");AND(b1=\"boi\";b2=\"não\";b3=\"1\");AND(b1=\"boi\";b2=\"não\";b3=\"2\");AND(b1=\"boi\";b2=\"não\";b3=\"3\")) \n<b style=\"color:black;\">05🠚c: </b>r{c}=OR(AND(c1=\"3\")) \n<b style=\"color:black;\">05🠚d: </b>r{d}=OR(AND(TRUE)) \n<b style=\"color:black;\">05🠚e: </b>r{e}=OR(AND(FALSE))<br><b style=\"color:red;\">BQ: 6</b></meugabtxt></meugab></p>`,
      fb=true,
      questoes,
      nExp = 3*40,
      respostas = [ "⦅01🠚id{a}🠖13,918⦆","⦅01🠚id{b}🠖4,4⦆","⦅01🠚id{c}🠖32⦆","⦅02🠚id{a}🠖0,3⦆","⦅02🠚id{b}🠖7⦆","⦅02🠚id{e1}🠖\"positivo\"⦆","⦅02🠚id{e2}🠖\"n1 > n2\"⦆","⦅02🠚id{f}🠖42⦆","⦅03🠚id{2000}🠖\"2000\"⦆","⦅04🠚id{lilás}🠖\"☐\"⦆","⦅04🠚id{amarelo}🠖\"amarelo\"⦆","⦅04🠚id{vermelho}🠖\"☐\"⦆","⦅04🠚id{rosa}🠖\"rosa\"⦆","⦅04🠚id{azul}🠖\"azul\"⦆","⦅05🠚id{d}🠖\"true\"⦆","⦅05🠚id{c}🠖\"false\"⦆","⦅05🠚id{b}🠖\"true\"⦆","⦅05🠚id{e}🠖\"false\"⦆","⦅05🠚id{a}🠖\"true\"⦆"]      ,
      linha_dadosTurma = 9,
      nTentativa = 1,
      linha_aluno = 9,
      textoCompletoSelacao = `⦅02🠚n1🠖4,50⦆
⦅02🠚n2🠖9,417⦆
02🠚id{b}: ABS(r{b}/(     n2-n1     )-1)<2%
02🠚id{c1}: OR(ABS(r{c1}/(     n1/n2     )-1)<2%;ABS(r{c1}/(     n2/n1     )-1)<2%)
02🠚id{c2}: AND(r{c1}<>r{c2};OR(ABS(r{c2}/(     n1/n2     )-1)<2%;ABS(r{c2}/(     n2/n1     )-1)<2%))
02🠚id{d}: r{d}="n1"&"/"&"n2"
02🠚id{e1}: r{e1}=IF(n2>n1;"positivo";"negativo")
02🠚id{e2}: r{e2}=IF(n2>n1;"n2 > n1";"n1 > n2")
02🠚id{f}: ABS(r{f}/(     g{a}-g{b}+100     )-1)<2%`;       //consolePlanilha(respondidos);


  switch (19) { 
  case  1: consolePlanilha(       capturarEmail_AE_7_8_25()                                                               ); break; 
  case  2: consolePlanilha(                                                                                     ); break; 
  case  3: consolePlanilha(       gravarExp(nExp,link,linha_aluno)                                                    ); break; 
  case  4: consolePlanilha(       linhadoemail_AE_7_8_25(turma,mail)                                                      ); break; 
  case  5: consolePlanilha(       gravarRespLista(turma,respostas,variaveis,nlista,htmlPergResp,fb,mail)        ); break; 
  case  6: consolePlanilha(       numerosListas(turma)                                                          ); break; 
  case  7: consolePlanilha(       puxarLista(nlista/*,         turma */          ,nVinculo,mail)    )          ; break; 
  case  8: consolePlanilha(       substitui(questoes,mail,nTentativa)                                                      ); break; 
  case  9: console.log(       correcao_AE_01_08_25(respondidos,variav,selectrow,turma,nlista)                           ); break;
  case  10:consolePlanilha(       dadosIniciais()                                                               ); break;
  case  11:consolePlanilha(       dadosVideo(nColVD,linha_aluno,linha_dadosTurma,mail/*,nTentativa*/)                                 ); break;
  case  12:
  
  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
              for(var a = 1; a < 5; a++){
              switch (a) { 
              case 1:    //VF
                var turma = "Pa",mail = "ezequiel.melo@ifsc.edu.br",nColVD = 337, nPergunta = 1, resposta = '⦅££🠚id{b}🠖"false"⦆⦅££🠚id{d}🠖"true"⦆⦅££🠚id{a}🠖"false"⦆⦅££🠚id{c}🠖"true"⦆⦅££🠚id{e}🠖"false"⦆', variaveis = '⦅££🠚a1🠖"pizza"⦆⦅££🠚a2🠖"cilíndrica"⦆⦅££🠚b1🠖"galo"⦆⦅££🠚b2🠖"não"⦆⦅££🠚b3🠖"4"⦆⦅££🠚c1🠖"3"⦆';
              break;
              case 2:    //NUM,LS,REG
                var turma = "Pa",mail = "ezequiel.melo@ifsc.edu.br",nColVD = 337, nPergunta = 2, resposta = '⦅££🠚id{a}🠖13,92⦆⦅££🠚id{e1}🠖"positivo"⦆⦅££🠚id{e2}🠖"n2 > n1"⦆⦅££🠚id{f}🠖109,4⦆', variaveis = "⦅01🠚n1🠖4,50⦆⦅01🠚n2🠖9,417⦆";
              break;
              case 3:   //E
                var turma = "Pa",mail = "ezequiel.melo@ifsc.edu.br",nColVD = 337, nPergunta = 3, resposta = '⦅££🠚id{rosa}🠖"☐"⦆⦅££🠚id{vermelho}🠖"☐"⦆⦅££🠚id{azul}🠖"azul"⦆⦅££🠚id{amarelo}🠖"☐"⦆⦅££🠚id{lilás}🠖"lilás"⦆' , variaveis = "";
              break;
              case 4:   //OU 
                var turma = "Pa",mail = "ezequiel.melo@ifsc.edu.br",nColVD = 337, nPergunta = 4, resposta = '⦅££🠚id{1500}🠖"1500"⦆' , variaveis = "";
              break;
              default:
              break;
              }
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  consolePlanilha(       corrigirPergViAu(nPergunta,nColVD,resposta,variaveis,linha_dadosTurma)              ); 
  
  };
  
  break;
  case  13: 
        var listaFuncoes = PLANILHA.getSheetByName("Provisorio").getRange("A427").getValues(); //consolePlanilha(listaFuncoes);
        listaFuncoes.forEach(function(aa,indice){consolePlanilha(funcaoSheetToJS(aa[0],indice))}  ); break;

  case  14:consolePlanilha(       
  // funcaoSheetToJS('7=ROUNDUP(SQRT((((3,84400000/(365*24*60*60))*COS(3*PI()/180)*3)^2)-(((2*384,400000/(365*24*60*60))*LOG(10;2*PI()/18,0)*2-5*3*3)^2));3)')
  // , 
  funcaoSheetToJS("OR(ABS(42,32/(      ((64*3)^2)/(20*466*24)      )-1)<12%;'TR'&'UE'=TRUE;2<>3^2)")
          ); break;
  case  15: consolePlanilha(       salvandoViAu(linha_aluno,nColVD,"[5002,[10,0],[100,2],[0,4],[0,4]]")          ); break;

  case  16: consolePlanilha(                             dadosAlunos_AE_7_8_25(mail,true)                                ); break;
  case  17: consolePlanilha(                             doGet()                                ); break;
  //case  18: consolePlanilha(            dadosDoEmail_AE_7_8_25("ezequiel.melos@ifsc.edu.br")              ); break;

  case  18: /*console.log*/(    dadosIniciais(/*12,undefined,"nicoly.d@aluno.ifsc.edu.br",linha_aluno, questaoEmAula*/)       ); break;










 case  19:  console.log(11) //TESTAR doPost()  testarDoPost()

      // 1. Defina o objeto JSON que você quer enviar para a doPost
      let jsonDeTeste1 = { tipo: "dadosIniciais",  nome: "Zé Testador", "e-mail": "ze.testador@example.com", nascimento: ["01/01/1990", "Marte"] }; //colar no "id:" o id que o Gogle gera ao ao executar uma função no site após o login 
      // E_MAIL_DETECTADO = undefined;
      let meuJsonDeTeste = { tipo: "autenticacaoInicial",  dados: [null,"eyJhbGciOiJSUzI1NiIsImtpZCI6ImJhNjNiNDM2ODM2YTkzOWI3OTViNDEyMmQzZjRkMGQyMjVkMWM3MDAiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI5MDE0MjM2NDY3NS1vZW80aG91YWZrZmw5c2o2ZmNicXQ3MWluanY4djNqai5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjkwMTQyMzY0Njc1LW9lbzRob3VhZmtmbDlzajZmY2JxdDcxaW5qdjh2M2pqLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTEzNjc4MjA0NTQwMDU5MDUyNDMxIiwiaGQiOiJpZnNjLmVkdS5iciIsImVtYWlsIjoiZXplcXVpZWwubWVsb0BpZnNjLmVkdS5iciIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYmYiOjE3NTQ4NjA2MDIsIm5hbWUiOiJFemVxdWllbCBCb3JnZXMgTWVsbyIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NMZUlzOVcxWE9pOGN6Nkl6WS1wTzByWkdNcjRTQzhKR01adEFVTmk5bjhxY2JGSnljPXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6IkV6ZXF1aWVsIiwiZmFtaWx5X25hbWUiOiJCb3JnZXMgTWVsbyIsImlhdCI6MTc1NDg2MDkwMiwiZXhwIjoxNzU0ODY0NTAyLCJqdGkiOiJkY2JjYTE4ZjU0NDNmYTcyNDc1MTNmYjg0NTgyOTM1MjBkNTcwMjJiIn0.iuysL4FlEUbgBdpIL8TDdBzlbj7YEQm3ZY72pCinT-w2DvBJ3k1syNcrkxovL3Q4CRo4zeWfqbis_1mkZ1BkqK02o3N61EJ_zTDEcgngOSqTaCHr2MplYjP6qr2gQmWnBEPwGXF9l9psb7h3VANstFB5ilspw7QzUcV15W6L8gaJ1e2-RZdzkGr09oF9JmeQJI96ZNjXfFfTejKsJtBY8ND40JmhpyT7L9PXLz7QVPHKX9VI4hySq4mRYHqzYMvyXuEqc3EmvYOuLlaUw-vbshGLohnIrxR6VXHj2i264OcG1PDdEU9pjzAWACJ96O0awmO-V_d5DarebfBE4mBsiw"], id: "" }/*{"tipo":"salvandoViAu","dados":[9,211,"[5079,[20,1],[100,2],[20,5],[100,5]]"]}*/;

      // 2. Crie um objeto 'e' simulado que a doPost espera
      let eventoSimulado = {    parameter: {   payloadJson: JSON.stringify(meuJsonDeTeste)    },  };

      // 3. Chame a doPost com o evento simulado
      consolePlanilha("Iniciando teste da doPost...");
      let resultado = doPost(eventoSimulado); // A doPost retornará um ContentService.TextOutput

      // 4. Para ver o conteúdo da resposta no Logger do Apps Script:
      // O consolePlanilha dentro da doPost já mostrará o objeto 'response'.
      // Se quiser ver o conteúdo da string retornada pelo ContentService:
      if (resultado && typeof resultado.getContent === 'function') {
        consolePlanilha("Conteúdo retornado:"/*+" ocultado"*/ + resultado.getContent());
      } else {
        consolePlanilha("Resultado da doPost não é um objeto ContentService válido ou é nulo.");
      }
      consolePlanilha("Teste da doPost concluído.");


break;

  case  20: //Criptografia

    consolePlanilha(iniciar())                   
  break;











  default:break;        };


  
  }


